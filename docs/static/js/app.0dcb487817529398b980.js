webpackJsonp([1],{"4+hh":function(e,t){},"68C1":function(e,t){},"7jIL":function(e,t){},"9+ik":function(e,t){},"A+BG":function(e,t){},A66K:function(e,t){},GHAV:function(e,t){},KdU5:function(e,t){},MvkS:function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("7+uW"),i=a("/ocq"),n=a("mtWM"),o=a.n(n),r={name:"home",data:function(){return{showAlert:!1,showDialog:!1,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this,t=new Date(Date.UTC(2018,8,3,12,0,0));new Date(Date.now())<t&&setTimeout(function(){e.showAlert=!0},500)},methods:{shareOnTwitter:function(){window.open("http://twitter.com/share?url="+encodeURIComponent("https://shareloc.xyz")+"&text="+encodeURIComponent(" #ShareLoc "),"","left=0,top=0,width=550,height=450,personalbar=0,toolbar=0,scrollbars=0,resizable=0")}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[e.showAlert?a("md-toolbar",[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("p",{staticClass:"alert"},[e._v("Notice: we recently fixed a bug occured when importing large csv file to ShareLoc, the fixed version produces 1.3GB smlm file with 7.2GB csv file ("),a("a",{attrs:{target:"_blank",href:"https://github.com/imodpasteur/smlm-file-format"}},[e._v("more details")]),e._v(").")]),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.showAlert=!1}}},[a("md-icon",[e._v("close")])],1)],1)])]):e._e(),e._v(" "),a("div",{staticClass:"md-toolbar-row md-layout md-alignment-center-center"},[a("div",{staticClass:"banner-container"},[a("img",{staticClass:"bg",attrs:{src:"/static/img/bg.jpg",alt:"banner"}}),e._v(" "),a("div",{staticClass:"subtitle"},[e._v("A platform for sharing localization microscopy data."),a("br"),e._v(" "),a("md-button",{staticClass:"md-raised",attrs:{href:"https://github.com/imodpasteur/smlm-file-format/blob/master/README.md",target:"_blank"}},[e._v("SMLM file format")]),e._v(" "),a("md-button",{staticClass:"md-raised md-accent",attrs:{to:"/viewer"}},[e._v("SMLM viewer")])],1)])]),e._v(" "),a("br"),e._v(" "),a("repository",{attrs:{"show-tags":!1,title:null}}),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showDialog},on:{"update:mdActive":function(t){e.showDialog=t}}},[a("md-dialog-title",[e._v("Getting Started: the shareLocViewer")]),e._v(" "),a("md-dialog-content",[a("p",[e._v("With the shareLocViewer web app, you render and analyse your data  within the browser, no installation, open a localization table and process instantly.")]),e._v(" "),a("md-button",{staticClass:"md-raised md-primary",attrs:{to:"viewer"}},[e._v("Start")]),e._v(" "),a("p",[e._v("You can render your data with the viewer anonymously, for the sharing and shareLoc.xyz feature you will be asked to login, please "),a("a",{on:{click:function(t){e.showDialog=!1,e.api.showLogin()}}},[e._v("sign up")]),e._v(" in advance.")]),e._v(" "),a("p",[e._v("We are actively improving the shareLoc.xyz web platform, please "),a("a",{on:{click:function(t){e.showDialog=!1,e.api.showLogin()}}},[e._v("sign up")]),e._v(" with your e-mail to be notified when new features are available.")])],1),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showDialog=!1}}},[e._v("OK")])],1)],1),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("md-divider"),e._v(" "),a("main-footer")],1)},staticRenderFns:[]};var d=a("VU/8")(r,l,!1,function(e){a("xzB3")},"data-v-bdaea096",null).exports,m=["Aardvark","Albatross","Alligator","Alpaca","Ant","Anteater","Antelope","Ape","Armadillo","Ass_Donkey","Baboon","Badger","Barracuda","Bat","Bear","Beaver","Bee","Bison","Boa","Buffalo","Butterfly","Camel","Capybara","Caribou","Cassowary","Cat","Caterpillar","Cattle","Chamois","Cheetah","Chicken","Chimpanzee","Chinchilla","Chough","Clam","Cobra","Cockroach","Cod","Cormorant","Coyote","Crab","Crane","Crocodile","Crow","Curlew","Deer","Dinosaur","Dog","Dogfish","Dolphin","Donkey","Dotterel","Dove","Dragonfly","Duck","Dugong","Dunlin","Eagle","Echidna","Eel","Eland","Elephant","Elephantseal","Elk","Emu","Falcon","Ferret","Finch","Fish","Flamingo","Fox","Frog","Gaur","Gazelle","Gerbil","GiantPanda","Giraffe","Gnat","Gnu","Goat","Goose","Goldfinch","Goldfish","Gorilla","Goshawk","Grasshopper","Grouse","Guanaco","Guineafowl","Guineapig","Gull","Hamster","Hare","Hawk","Hedgehog","Heron","Herring","Hippopotamus","Hornet","Horse","Human","Hummingbird","Hyena","Ibex","Ibis","Jackal","Jaguar","Jay","Jellyfish","Kangaroo","Kingfisher","Koala","Komodo","Kookabura","Kouprey","Kudu","Lapwing","Lark","Lemur","Leopard","Lion","Llama","Lobster","Locust","Loris","Louse","Lyrebird","Magpie","Mallard","Manatee","Mandrill","Mantis","Marten","Meerkat","Mink","Mole","Mongoose","Monkey","Moose","Mouse","Mosquito","Mule","Narwhal","Newt","Nightingale","Octopus","Okapi","Opossum","Oryx","Ostrich","Otter","Owl","Ox","Oyster","Panther","Parrot","Partridge","Peafowl","Pelican","Penguin","Pheasant","Pig","Pigeon","PolarBear","Pony","Porcupine","Porpoise","PrairieDog","Quail","Quelea","Quetzal","Rabbit","Raccoon","Rail","Ram","Rat","Raven","Reddeer","Redpanda","Reindeer","Rhinoceros","Rook","Salamander","Salmon","SandDollar","Sandpiper","Sardine","Scorpion","Sealion","SeaUrchin","Seahorse","Seal","Shark","Sheep","Shrew","Skunk","Snail","Snake","Sparrow","Spider","Spoonbill","Squid","Squirrel","Starling","Stingray","Stinkbug","Stork","Swallow","Swan","Tapir","Tarsier","Termite","Tiger","Toad","Trout","Turkey","Turtle","Vicuï¿½a","Viper","Vulture","Wallaby","Walrus","Wasp","Waterbuffalo","Weasel","Whale","Wolf","Wolverine","Wombat","Woodcock","Woodpecker","Worm","Wren","Yak","Zebra"],c=["almond","amaranthine","amber","amethyst","antique","apple","apricot","aqua","aquamarine","argent","auburn","avocado","azure","babyblue","banana","battleshipgray","bay","beige","Bermudagreen","beryl","biceblue","bicegreen","bice","biscuit","bisque","black","blanchedalmond","blazeorange","blonde","bloodred","bluegreen","blueviolet","blue","blueberry","bone","bottlegreen","brass","brickred","bronzeyellow","bronze","brown","buckskin","buff","burgundy","burlywood","burntorange","burntsienna","burntumber","butterscotch","cadetblue","Cambridgeblue","canary","cardinal","carmine","carnation","carnelian","carroty","celadon","cerise","cerulean","chamois","champagne","charcoal","chartreuse","cherryred","chestnut","Chinesered","chocolate","cinereous","cinnabar","cinnamon","citrine","clairdelune","claret","coalblack","cobaltblue","cocoa","coffee","coolgray","Copenhagenblue","copper","coral","cornflowerblue","cornflower","cornsilk","cream","crimson","cupreous","cyan","daffodil","damask","dandelion","dovegray","duckeggblue","dun","Dodgerblue","eaudenil","ebony","ecru","eggshellblue","eggshell","electricblue","emeraldgreen","emerald","fawn","federalyellow","firebrick","fireenginered","flame","flamingo","flaxen","flesh","floralwhite","forestgreen","fuchsia","fuscous","gainsboro","gamboge","garnet","gentianblue","gentianviolet","geranium","ginger","glaucous","gold","goldenbrown","goldenrod","goldochre","grape","grassgreen","gray","green","grizzle","gules","gunmetalgray","hazel","heather","heliotrope","henna","hepatic","hoar","honey","honeydew","hotpink","huntergreen","iceblue","incarnadine","Indianred","indigo","internationalorange","irongray","ivory","jadegreen","jade","jet","jonquil","kellygreen","Kendalgreen","khaki","khakigreen","lapislazuli","laurelgreen","lavender","lemonchiffon","lemon","lilac","lime","Lincolngreen","linen","liver","loden","lovat","macaroniandcheese","madder","magenta","magicmint","magnolia","mahogany","malachite","maroon","mauve","mazarine","melon","midnightblue","mignonette","militarygrey","mint","mintcream","mistyrose","moccasin","mocha","mossgreen","mulberry","mustard","natural","navajowhite","navy","Nileblue","Nilegreen","oak","oatmeal","oceangrey","ochre","offwhite","oldgold","oldlace","olivedrab","olive","orange","orchid","outerspace","oxblood","Oxfordblue","oyster","pansy","paprika","Parisgreen","patina","peagreen","peach","peacockblue","pearlgray","pearly","periwinkle","perse","petrolblue","petunia","pewter","pillarboxred","pinegreen","pink","pistachiogreen","platinumblond","platinum","plum","Pompeianred","poppy","powderblue","primrose","Prussianblue","puce","puke","purple","purpure","quartz","quince","raspberry","rawsienna","redviolet","red","reseda","riflegreen","robin_seggblue","rose","rouge","royalblue","royalpurple","ruby","russet","rust","sable","saddlebrown","safetyorange","saffron","sagegreen","salmon","sand","sandy","sanguine","sapphire","sard","saxeblue","scarlet","schoolbusyellow","seagreen","seashell","sepia","shockingpink","sienna","silver","silvergray","skyblue","slate","slateblack","slateblue","slategray","smoke","snow","sorrel","springgreen","stammel","steelblue","stone","straw","strawberry","sulfur","sunflower","tan","tangerine","taupe","taxiyellow","teak","teal","terracotta","timberwolf","titian","topaz","towcolored","Turkeyred","turquoise","Tyrianpurple","ultramarine","umber","Vandykebrown","venetianred","verdant","vermilion","vert","violetred","violet","virid","viridian","vividorange","walnut","Wedgewoodblue","wheat","wheaten","white","wine","xanthic","yellow","zaffre"];var u={getPixels:function(e){var t=e;return t.getContext("2d").getImageData(0,0,t.width,t.height)},filterImage:function(e,t,a){for(var s=[e],i=2;i<arguments.length;i++)s.push(arguments[i]);return t.apply(null,s)},grayscale:function(e,t){for(var a=e.data,s=0;s<a.length;s+=4){var i=.2126*a[s]+.7152*a[s+1]+.0722*a[s+2];a[s]=a[s+1]=a[s+2]=i}return e},brightness:function(e,t,a){for(var s,i=e.data,n=0;n<i.length;n+=4)(s=parseInt((i[n]-t)*a))>255?s=255:s<0&&(s=0),i[n]=s,i[n+1]=s,i[n+2]=s,i[n+3]=255;return e},min_max:function(e){for(var t=e.data,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,i=0,n=0;n<t.length;n+=4)t[n]<a&&(a=t[n]),t[n]>s&&(s=t[n]),i+=t[n]/(t.length/4);return{min:a,max:s,avg:i}},lut:function(e,t){for(var a,s=e.data,i=0;i<s.length;i+=4)a=s[i],s[i]=t[a][0],s[i+1]=t[a][1],s[i+2]=t[a][2],s[i+3]=255;return e}},_=[[10,0,0],[13,0,0],[15,0,0],[18,0,0],[21,0,0],[23,0,0],[26,0,0],[28,0,0],[31,0,0],[34,0,0],[36,0,0],[39,0,0],[42,0,0],[44,0,0],[47,0,0],[49,0,0],[52,0,0],[55,0,0],[57,0,0],[60,0,0],[63,0,0],[65,0,0],[68,0,0],[70,0,0],[73,0,0],[76,0,0],[78,0,0],[81,0,0],[84,0,0],[86,0,0],[89,0,0],[91,0,0],[94,0,0],[97,0,0],[99,0,0],[102,0,0],[105,0,0],[107,0,0],[110,0,0],[112,0,0],[115,0,0],[118,0,0],[120,0,0],[123,0,0],[126,0,0],[128,0,0],[131,0,0],[133,0,0],[136,0,0],[139,0,0],[141,0,0],[144,0,0],[147,0,0],[149,0,0],[152,0,0],[154,0,0],[157,0,0],[160,0,0],[162,0,0],[165,0,0],[168,0,0],[170,0,0],[173,0,0],[175,0,0],[178,0,0],[181,0,0],[183,0,0],[186,0,0],[189,0,0],[191,0,0],[194,0,0],[196,0,0],[199,0,0],[202,0,0],[204,0,0],[207,0,0],[210,0,0],[212,0,0],[215,0,0],[217,0,0],[220,0,0],[223,0,0],[225,0,0],[228,0,0],[231,0,0],[233,0,0],[236,0,0],[238,0,0],[241,0,0],[244,0,0],[246,0,0],[249,0,0],[252,0,0],[254,0,0],[255,2,0],[255,5,0],[255,7,0],[255,10,0],[255,12,0],[255,15,0],[255,18,0],[255,20,0],[255,23,0],[255,26,0],[255,28,0],[255,31,0],[255,33,0],[255,36,0],[255,39,0],[255,41,0],[255,44,0],[255,47,0],[255,49,0],[255,52,0],[255,54,0],[255,57,0],[255,60,0],[255,62,0],[255,65,0],[255,68,0],[255,70,0],[255,73,0],[255,75,0],[255,78,0],[255,81,0],[255,83,0],[255,86,0],[255,89,0],[255,91,0],[255,94,0],[255,96,0],[255,99,0],[255,102,0],[255,104,0],[255,107,0],[255,110,0],[255,112,0],[255,115,0],[255,117,0],[255,120,0],[255,123,0],[255,125,0],[255,128,0],[255,131,0],[255,133,0],[255,136,0],[255,138,0],[255,141,0],[255,144,0],[255,146,0],[255,149,0],[255,151,0],[255,154,0],[255,157,0],[255,159,0],[255,162,0],[255,165,0],[255,167,0],[255,170,0],[255,172,0],[255,175,0],[255,178,0],[255,180,0],[255,183,0],[255,186,0],[255,188,0],[255,191,0],[255,193,0],[255,196,0],[255,199,0],[255,201,0],[255,204,0],[255,207,0],[255,209,0],[255,212,0],[255,214,0],[255,217,0],[255,220,0],[255,222,0],[255,225,0],[255,228,0],[255,230,0],[255,233,0],[255,235,0],[255,238,0],[255,241,0],[255,243,0],[255,246,0],[255,249,0],[255,251,0],[255,254,0],[255,255,2],[255,255,6],[255,255,10],[255,255,14],[255,255,18],[255,255,22],[255,255,26],[255,255,30],[255,255,34],[255,255,38],[255,255,42],[255,255,46],[255,255,50],[255,255,54],[255,255,58],[255,255,62],[255,255,65],[255,255,69],[255,255,73],[255,255,77],[255,255,81],[255,255,85],[255,255,89],[255,255,93],[255,255,97],[255,255,101],[255,255,105],[255,255,109],[255,255,113],[255,255,117],[255,255,121],[255,255,125],[255,255,128],[255,255,132],[255,255,136],[255,255,140],[255,255,144],[255,255,148],[255,255,152],[255,255,156],[255,255,160],[255,255,164],[255,255,168],[255,255,172],[255,255,176],[255,255,180],[255,255,184],[255,255,188],[255,255,191],[255,255,195],[255,255,199],[255,255,203],[255,255,207],[255,255,211],[255,255,215],[255,255,219],[255,255,223],[255,255,227],[255,255,231],[255,255,235],[255,255,239],[255,255,243],[255,255,247],[255,255,251],[255,255,255]],p={authid:"",uri:"",name:"",status:"",tags:[],description:"",task_template:{name:"",inputs:[{tags:[],files:[]}],outputs:[{files:[{name:"output",type:"image/png",url:""}]}],config:{},tags:[],expiresIn:120},task_schema:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",title:"task",properties:{expiresIn:{type:"number"},config:{type:"object",properties:{type:{type:"string"}}},inputs:{type:"array",items:{type:"object",properties:{tags:{type:"array",items:{type:"string"}},files:{type:"array",items:{type:"object",properties:{name:{type:"string"},type:{type:"string"},url:{type:"string"}}}}}}}}}},h={name:"admin",data:function(){return{user_list:[],file_list:[],worker_list:[],sample_list:[],showUConfirm:!1,showFConfirm:!1,showSConfirm:!1,showWConfirm:!1,_user_2_remove:"",_file_2_remove:"",_worker_2_remove:"",_sample_2_remove:"",_file_owner_2_remove:"",_worker_owner_2_remove:"",_sample_owner_2_remove:"",open_worker_dialog:!1,task_template:{},task_schema:{},inputs_schema:{},outputs_template:{},worker_config:{},confirm_message:"nothing to confirm",router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api,print:console.log,hostname:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}},mounted:function(){var e=this,t=function(){e.update_file_list(),e.update_worker_list(),e.update_sample_list(),e.update_user_list()};this.store.signed_in?t():this.store.event_bus.$on("signed_in",t)},methods:{showAddWorker:function(){this.worker_config=p,this.worker_config.name=c[Math.floor(Math.random()*c.length)].toLowerCase()+"_"+m[Math.floor(Math.random()*m.length)].toLowerCase(),this.worker_config.authid=Math.random().toString(36).substr(2,10),this.worker_config.tags=[],this.worker_config.description="",this.open_worker_dialog=!0},add_worker:function(e){var t=this;this.store.session.call("org.imod.admin.workers.add_worker",[{tags:this.worker_config.tags,name:this.worker_config.name,authid:this.worker_config.authid,uri:this.worker_config.uri}],{},{disclose_me:!0}).then(function(e){t.api.show("worker added."),t.update_worker_list()}).catch(function(e){console.log(e),t.api.show(e)})},update_user_list:function(){var e=this;this.store.session.call("org.imod.admin.get_user_list",[{}],{},{disclose_me:!0}).then(function(t){e.api.show("user list updated."),e.user_list=t}).catch(function(t){console.log(t),e.api.show(t)})},remove_user:function(e){var t=this;this.store.session.call("org.imod.admin.remove_user",[e],{},{disclose_me:!0}).then(function(a){t.api.show("user '"+e+"' is removed."),t.update_user_list()}).catch(function(e){console.log(e),t.api.show(e)})},update_file_list:function(){var e=this;this.store.session.call("org.imod.admin.files.get_file_list",[{}],{},{disclose_me:!0}).then(function(t){e.api.show("file list updated."),e.file_list=t}).catch(function(t){console.log(t),e.api.show(t)})},remove_file:function(e,t){var a=this;this.store.session.call("org.imod.admin.files.remove_file",[e,t],{},{disclose_me:!0}).then(function(e){a.api.show("file '"+t+"' is removed."),a.update_file_list()}).catch(function(e){console.log(e),a.api.show(e)})},clean_up_files:function(){var e=this;this.store.session.call("org.imod.admin.files.clean_files",[{}],{},{disclose_me:!0}).then(function(t){e.api.show("files are cleaned."),e.update_file_list()}).catch(function(t){console.log(t),e.api.show(t)})},update_worker_list:function(){var e=this;this.store.session.call("org.imod.admin.workers.get_worker_list",[{}],{},{disclose_me:!0}).then(function(t){e.api.show("worker list updated."),e.worker_list=t}).catch(function(t){console.log(t),e.api.show(t)})},remove_worker:function(e){var t=this;this.store.session.call("org.imod.admin.workers.remove_worker",[e],{},{disclose_me:!0}).then(function(a){t.api.show("worker '"+e.$oid+"' is removed."),t.update_worker_list()}).catch(function(e){console.log(e),t.api.show(e)})},update_sample_list:function(){var e=this;this.store.session.call("org.imod.admin.samples.get_sample_list",[{}],{},{disclose_me:!0}).then(function(t){e.api.show("sample list updated."),e.sample_list=t}).catch(function(t){console.log(t),e.api.show(t)})},remove_sample:function(e){var t=this;this.store.session.call("org.imod.admin.samples.remove_sample",[e],{},{disclose_me:!0}).then(function(a){t.api.show("sample '"+e.$oid+"' is removed."),t.update_sample_list()}).catch(function(e){console.log(e),t.api.show(e)})},clean_up_samples:function(){var e=this;this.store.session.call("org.imod.admin.samples.clean_samples",[{}],{},{disclose_me:!0}).then(function(t){e.api.show("samples are cleaned."),e.update_sample_list()}).catch(function(t){console.log(t),e.api.show(t)})}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"admin"},[a("md-dialog-confirm",{attrs:{"md-active":e.showUConfirm,"md-title":"Delete confirmation","md-content":"Are you sure to remove this user?","md-confirm-text":"Yes","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showUConfirm=t},"md-cancel":function(t){e.showUConfirm=!1},"md-confirm":function(t){e.showUConfirm=!1,e.remove_user(e._user_2_remove)}}}),e._v(" "),a("md-dialog-confirm",{attrs:{"md-active":e.showFConfirm,"md-title":"Delete confirmation","md-content":"Are you sure to remove this file?","md-confirm-text":"Yes","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showFConfirm=t},"md-cancel":function(t){e.showFConfirm=!1},"md-confirm":function(t){e.showFConfirm=!1,e.remove_file(e._file_owner_2_remove,e._file_2_remove)}}}),e._v(" "),a("md-dialog-confirm",{attrs:{"md-active":e.showWConfirm,"md-title":"Delete confirmation","md-content":"Are you sure to remove this worker?","md-confirm-text":"Yes","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showWConfirm=t},"md-cancel":function(t){e.showWConfirm=!1},"md-confirm":function(t){e.showWConfirm=!1,e.remove_worker(e._worker_2_remove)}}}),e._v(" "),a("md-dialog-confirm",{attrs:{"md-active":e.showSConfirm,"md-title":"Delete confirmation","md-content":"Are you sure to remove this sample?","md-confirm-text":"Yes","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showSConfirm=t},"md-cancel":function(t){e.showSConfirm=!1},"md-confirm":function(t){e.showSConfirm=!1,e.remove_sample(e._sample_2_remove)}}}),e._v(" "),a("md-subheader",[e._v("Users")]),e._v(" "),a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("md-table",[a("md-table-toolbar",[a("md-button",{staticClass:"md-primary",on:{click:e.update_user_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")]),e._v("Refresh")],1)],1),e._v(" "),a("md-table-row",[a("md-table-head",[e._v("ID")]),e._v(" "),a("md-table-head",[e._v("Date")]),e._v(" "),a("md-table-head",[e._v("Email Pending")]),e._v(" "),a("md-table-head",[e._v("Actions")])],1),e._v(" "),e._l(e.user_list,function(t){return a("md-table-row",{key:t.authid},[a("md-table-cell",[e._v(e._s(t.authid))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.createdAt))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.emails?t.emails.length:0))]),e._v(" "),a("md-table-cell",[a("md-button",{staticClass:"md-primary",on:{click:function(a){e._user_2_remove=t.authid,e.showUConfirm=!0}}},[e._v("delete")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(a){e.print(t)}}},[e._v("print")])],1)],1)})],2)],1)],1),e._v(" "),a("br"),e._v(" "),a("md-subheader",[e._v("Workers")]),e._v(" "),a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("md-table",[a("md-table-toolbar",[a("md-button",{staticClass:"md-fab md-primary",on:{click:function(t){e.showAddWorker()}}},[a("md-icon",[e._v("add")]),e._v(" "),a("md-tooltip",[e._v("Add a worker")])],1),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:e.update_worker_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")]),e._v("Refresh")],1)],1),e._v(" "),a("md-table-row",[a("md-table-head",[e._v("Owner")]),e._v(" "),a("md-table-head",[e._v("Name")]),e._v(" "),a("md-table-head",[e._v("Tags")]),e._v(" "),a("md-table-head",[e._v("URI")]),e._v(" "),a("md-table-head",[e._v("AuthID")]),e._v(" "),a("md-table-head",[e._v("Secret")]),e._v(" "),a("md-table-head",[e._v("Actions")])],1),e._v(" "),e._l(e.worker_list,function(t){return a("md-table-row",{key:t._id.$oid},[a("md-table-cell",[e._v(e._s(t.owner))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.name))]),e._v(" "),a("md-table-cell",[a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                 "+e._s(a)+"\n               ")]}}]),model:{value:t.tags,callback:function(a){e.$set(t,"tags",a)},expression:"worker.tags"}})],1),e._v(" "),a("md-table-cell",[e._v(e._s(t.uri))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.authid))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.secret))]),e._v(" "),a("md-table-cell",[a("md-button",{staticClass:"md-primary",on:{click:function(a){e._worker_2_remove=t._id,e.showWConfirm=!0}}},[e._v("delete")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(a){e.print(t)}}},[e._v("print")])],1)],1)})],2)],1)],1),e._v(" "),a("br"),e._v(" "),a("md-subheader",[e._v("Samples")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.clean_up_samples()}}},[e._v("Clean up samples")]),e._v(" "),a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("md-table",[a("md-table-toolbar",[a("md-button",{staticClass:"md-primary",on:{click:e.update_sample_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")]),e._v("Refresh")],1)],1),e._v(" "),a("md-table-row",[a("md-table-head",[e._v("Owner")]),e._v(" "),a("md-table-head",[e._v("Name")]),e._v(" "),a("md-table-head",[e._v("Tags")]),e._v(" "),a("md-table-head",[e._v("Actions")])],1),e._v(" "),e._l(e.sample_list,function(t){return a("md-table-row",{key:t._id.$oid},[a("md-table-cell",[e._v(e._s(t.owner))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.name))]),e._v(" "),a("md-table-cell",[a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                 "+e._s(a)+"\n               ")]}}]),model:{value:t.tags,callback:function(a){e.$set(t,"tags",a)},expression:"sample.tags"}})],1),e._v(" "),a("md-table-cell",[a("md-button",{staticClass:"md-primary",on:{click:function(a){e._sample_2_remove=t._id,e.showSConfirm=!0}}},[e._v("delete")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(a){e.print(t)}}},[e._v("print")]),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{href:e.hostname+"/#/view?sample="+t.hash,target:"_blank"}},[e._v("open")])],1)],1)})],2)],1)],1),e._v(" "),a("br"),e._v(" "),a("md-subheader",[e._v("Files")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.clean_up_files()}}},[e._v("Clean up files")]),e._v(" "),a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("md-table",[a("md-table-toolbar",[a("md-button",{staticClass:"md-primary",on:{click:e.update_file_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")]),e._v("Refresh")],1)],1),e._v(" "),a("md-table-row",[a("md-table-head",[e._v("Owner")]),e._v(" "),a("md-table-head",[e._v("Name")]),e._v(" "),a("md-table-head",[e._v("Bucket")]),e._v(" "),a("md-table-head",[e._v("Tags")]),e._v(" "),a("md-table-head",[e._v("Size")]),e._v(" "),a("md-table-head",[e._v("Actions")])],1),e._v(" "),e._l(e.file_list,function(t){return a("md-table-row",{key:t.key},[a("md-table-cell",[e._v(e._s(t.owner))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.name))]),e._v(" "),a("md-table-cell",[e._v(e._s(t.bucket))]),e._v(" "),a("md-table-cell",[a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                 "+e._s(a)+"\n               ")]}}]),model:{value:t.tags,callback:function(a){e.$set(t,"tags",a)},expression:"file.tags"}})],1),e._v(" "),a("md-table-cell",[e._v(e._s(t.size))]),e._v(" "),a("md-table-cell",[a("md-button",{staticClass:"md-primary",on:{click:function(a){e._file_2_remove=t.key,e._file_owner_2_remove=t.owner,e.showFConfirm=!0}}},[e._v("delete")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(a){e.print(t)}}},[e._v("print")])],1)],1)})],2)],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.open_worker_dialog},on:{"update:mdActive":function(t){e.open_worker_dialog=t}}},[a("md-dialog-title",[e._v("Create a new worker")]),e._v(" "),a("md-dialog-content",[a("form",[a("md-field",[a("label",{attrs:{for:"worker-name"}},[e._v("Name")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.worker_config.name,callback:function(t){e.$set(e.worker_config,"name",t)},expression:"worker_config.name"}})],1),e._v(" "),a("md-field",[a("label",{attrs:{for:"worker-uri"}},[e._v("URI")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.worker_config.uri,callback:function(t){e.$set(e.worker_config,"uri",t)},expression:"worker_config.uri"}})],1),e._v(" "),a("label",{attrs:{for:"worker-tags"}},[e._v("Tags")]),e._v(" "),a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n               "+e._s(a)+"\n             ")]}}]),model:{value:e.worker_config.tags,callback:function(t){e.$set(e.worker_config,"tags",t)},expression:"worker_config.tags"}}),e._v(" "),a("md-field",[a("label",{attrs:{for:"worker-description"}},[e._v("Description")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.worker_config.description,callback:function(t){e.$set(e.worker_config,"description",t)},expression:"worker_config.description"}})],1),e._v(" "),a("h2",[e._v("authid: "+e._s(e.worker_config.authid))]),e._v(" "),a("h2",[e._v("secret: "+e._s(e.worker_config.secret))]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.open_worker_dialog=!1}}},[e._v("Cancel")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.open_worker_dialog=!1,e.add_worker(e.worker_config)}}},[e._v("OK")])],1)],1)])],1)],1)},staticRenderFns:[]};var g,v=a("VU/8")(h,f,!1,function(e){a("7jIL")},"data-v-55492f18",null).exports,w=a("bOdI"),b=a.n(w),y={name:"samples",data:function(){return{selected_file_name:"",file_list:[],sample_list:[],sample_name:"",sample_tags:[],sample_type:"",showSamples:!1,selected_sample:null,mode:"upload",open_sample_dialog:!1,store:this.$root.$data.store,api:this.$root.$data.store.api,sample_callback:this.edit_sample}},mounted:function(){var e=this,t=function(){e.update_sample_list()};this.store.signed_in?t():(this.store.event_bus.$on("signed_in",t),this.api.showLogin())},methods:(g={onSelectSample:function(e){this.selected_sample=e,console.log(e)}},b()(g,"onSelectSample",function(e){this.selected_sample=e||this.selected_sample,this.api.showSampleDialog(this.selected_sample),console.log(this.selected_sample)}),b()(g,"selectFile",function(){this.upload_prgress=0,this.$refs.select_file_input.click()}),b()(g,"edit_sample",function(e){if(e)if(this.selected_sample){this.selected_sample._id,e.name,e.type;console.log("edit sample")}else this.api.show("no sample is selected.")}),b()(g,"add_sample",function(){var e=this;this.store.session.call("org.imod.user.samples.add_sample",[{name:this.sample_name,tags:this.sample_tags}],{},{disclose_me:!0}).then(function(t){e.api.show("sample added.")}).catch(function(t){console.log(t),e.api.show(t,5e3)})}),b()(g,"update_sample_list",function(){var e=this;this.store.session.call("org.imod.user.samples.get_sample_list",[{owner:this.store.authid}],{},{disclose_me:!0}).then(function(t){e.api.show("sample list updated."),e.sample_list=t}).catch(function(t){console.log(t),e.api.show(t,5e3)})}),b()(g,"update_file_list",function(){var e=this;this.store.session.call("org.imod.user.files.get_file_list",[{owner:this.store.authid}],{},{disclose_me:!0}).then(function(t){e.api.show("data list updated."),e.file_list=t}).catch(function(t){console.log(t),e.api.show(t,5e3)})}),b()(g,"remove_file",function(e){var t=this;this.store.session.call("org.imod.user.files.remove_file",[e],{},{disclose_me:!0}).then(function(a){t.api.show("file '"+e+"' is removed."),t.update_file_list()}).catch(function(e){console.log(e),t.api.show(e,5e3)})}),b()(g,"remove_sample",function(e){var t=this;this.store.session.call("org.imod.user.samples.remove_sample",[e],{},{disclose_me:!0}).then(function(a){t.api.show("sample '"+e+"' is removed."),t.update_sample_list()}).catch(function(e){console.log(e),t.api.show(e,5e3)})}),g)},k={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("md-content",[a("md-subheader",[e._v("Samples")]),e._v(" "),a("md-table",{attrs:{"md-model-id":"_id.$oid","md-card":""},scopedSlots:e._u([{key:"md-table-row",fn:function(t){var s=t.item;return a("md-table-row",{attrs:{"md-selectable":"single"},on:{"md-selected":function(e){}}},[a("md-table-cell",{attrs:{"md-label":"Name","md-sort-by":"name"}},[e._v(e._s(s.name))]),e._v(" "),a("md-table-cell",{attrs:{"md-label":"Files"}},[e._v(e._s(Object.keys(s.files).length))]),e._v(" "),a("md-table-cell",{attrs:{"md-label":"Tags"}},[a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n               "+e._s(a)+"\n             ")]}}]),model:{value:s.tags,callback:function(t){e.$set(s,"tags",t)},expression:"item.tags"}})],1),e._v(" "),a("md-table-cell",{attrs:{"md-label":"Actions"}},[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.onSelectSample(s)}}},[a("md-icon",[e._v("eye")]),e._v("show files\n             "),a("md-tooltip",[e._v("show files")])],1),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.selected_sample=null,e.api.showSampleDialog()}}},[a("md-icon",[e._v("add")]),e._v("Add file\n             "),a("md-tooltip",[e._v("Add a file")])],1),e._v(" "),a("md-menu",{attrs:{"md-size":"medium"}},[a("md-button",{staticClass:"md-primary md-icon-button",attrs:{"md-menu-trigger":""}},[a("md-icon",[e._v("more_horiz")])],1),e._v(" "),a("md-menu-content",[a("md-menu-item",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.remove_sample(s._id)}}},[a("md-icon",[e._v("trash")]),e._v("delete")],1)],1)],1)],1)],1)],1)}}]),model:{value:e.sample_list,callback:function(t){e.sample_list=t},expression:"sample_list"}},[a("md-table-toolbar",{attrs:{slot:"md-table-alternate-header"},slot:"md-table-alternate-header"},[a("div",{staticClass:"md-toolbar-section-start"},[a("md-button",{staticClass:"md-fab md-primary",on:{click:function(t){e.open_sample_dialog=!0}}},[a("md-icon",[e._v("add")]),e._v(" "),a("md-tooltip",[e._v("Create a sample")])],1),e._v(" "),a("div",{staticClass:"md-title"},[e._v("create a sample")])],1),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-primary",on:{click:e.update_sample_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")])],1),e._v(" "),a("md-button",{staticClass:"md-icon-button"},[a("md-icon",{staticClass:"md-accent"},[e._v("delete")])],1)],1)])],1),e._v(" "),a("br"),e._v(" "),a("files"),e._v(" "),a("md-dialog",{attrs:{"md-active":e.open_sample_dialog},on:{"update:mdActive":function(t){e.open_sample_dialog=t}}},[a("md-dialog-title",[e._v("Create a new sample")]),e._v(" "),a("md-dialog-content",[a("form",[a("md-field",[a("label",{attrs:{for:"sample-name"}},[e._v("Name")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.sample_name,callback:function(t){e.sample_name=t},expression:"sample_name"}})],1),e._v(" "),a("label",{attrs:{for:"sample-tags"}},[e._v("Tags")]),e._v(" "),a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n               "+e._s(a)+"\n             ")]}}]),model:{value:e.sample_tags,callback:function(t){e.sample_tags=t},expression:"sample_tags"}}),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.open_sample_dialog=!1}}},[e._v("Cancel")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.open_sample_dialog=!1,e.add_sample()}}},[e._v("OK")])],1)],1)])],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showSamples},on:{"update:mdActive":function(t){e.showSamples=t}}},[a("md-subheader",{directives:[{name:"show",rawName:"v-show",value:e.selected_sample,expression:"selected_sample"}]},[e._v("Samples")]),e._v(" "),e.selected_sample?a("md-table",{attrs:{"md-model-id":"_id.$oid","md-card":""},scopedSlots:e._u([{key:"md-table-row",fn:function(t){var s=t.item;return a("md-table-row",{attrs:{"md-selectable":"single"},on:{"md-selected":e.onSelectSample}},[a("md-table-cell",{attrs:{"md-label":"Name"}},[e._v(e._s(s.name))]),e._v(" "),a("md-table-cell",{attrs:{"md-label":"Samples"}},[e._v(e._s(s.samples.length))]),e._v(" "),a("md-table-cell",{attrs:{"md-label":"Actions"}},[a("md-menu",{attrs:{"md-size":"medium"}},[a("md-button",{staticClass:"md-primary md-icon-button",attrs:{"md-menu-trigger":""}},[a("md-icon",[e._v("more_horiz")])],1),e._v(" "),a("md-menu-content",[a("md-menu-item",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.remove_sample(s._id)}}},[a("md-icon",[e._v("trash")]),e._v("delete")],1)],1),e._v(" "),a("md-menu-item",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.rename_sample(s._id)}}},[a("md-icon",[e._v("pen")]),e._v("rename")],1)],1)],1)],1)],1)],1)}}]),model:{value:e.sample_list,callback:function(t){e.sample_list=t},expression:"sample_list"}},[a("md-table-toolbar",{attrs:{slot:"md-table-alternate-header"},slot:"md-table-alternate-header"},[a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-primary",on:{click:e.update_sample_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")])],1),e._v(" "),a("md-button",{staticClass:"md-icon-button"},[a("md-icon",{staticClass:"md-accent"},[e._v("delete")])],1)],1)])],1):e._e()],1),e._v(" "),a("sample-dialog",{attrs:{title:"Sample"},on:{close:e.sample_callback}})],1)},staticRenderFns:[]};var x=a("VU/8")(y,k,!1,function(e){a("OA9G")},"data-v-3b8962d4",null).exports,C={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"options"},[t("md-subheader",{directives:[{name:"show",rawName:"v-show",value:this.store.user_data&&this.store.user_data.uid,expression:"store.user_data && store.user_data.uid"}]},[this._v("User ID: "+this._s(this.store.user_data.uid))]),this._v(" "),t("password",{attrs:{action:"reset"}})],1)},staticRenderFns:[]};var S=a("VU/8")({name:"options",data:function(){return{router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){},methods:{}},C,!1,function(e){a("YZJ3")},"data-v-7e39b3fa",null).exports,A={name:"files",data:function(){return{selected_file_name:"",uploading:!1,upload_prgress:0,showDialog:!1,file_list:[],mode:"upload",store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this,t=function(){e.update_file_list()};this.store.signed_in?t():this.store.event_bus.$on("signed_in",t)},methods:{fileSelected:function(e){var t=e.target.files;console.log("file selected",t),t&&t.length>0&&(1==t.length?this.selected_file_name=t[0].name:this.selected_file_name=t[0].name+", "+t[1].name+" etc.",console.log(t),this.upload(t[0]))},selectFile:function(){this.upload_prgress=0,this.$refs.select_file_input.click()},update_file_list:function(){var e=this;this.store.session.call("org.imod.user.files.get_file_list",[{owner:this.store.authid}],{},{disclose_me:!0}).then(function(t){e.api.show("data list updated."),e.file_list=t}).catch(function(t){console.log(t),e.api.show(t)})},remove_file:function(e){var t=this;this.store.session.call("org.imod.user.files.remove_file",[e],{},{disclose_me:!0}).then(function(a){t.api.show("file '"+e+"' is removed."),t.update_file_list()}).catch(function(e){console.log(e),t.api.show(e)})},upload:function(e){var t=this;console.log(e),this.store.session.call("org.imod.user.files.get_upload_url",[{name:e.name,type:e.type,size:e.size}],{},{disclose_me:!0}).then(function(a){var s=a.url,i=a.key,n={headers:{"Content-Type":e.type},onUploadProgress:function(a){t.upload_prgress=1*a.loaded/e.size*100}};t.uploading=!0,console.log(s),o.a.put(s,e,n).then(function(a){t.uploading=!1,console.log("data uploaded, finishing"),t.store.session.call("org.imod.user.files.finish_upload",[i,{name:e.name,type:e.type,size:e.size}],{},{disclose_me:!0}).then(function(e){t.selected_file_name="",t.update_file_list(),t.$forceUpdate(),t.api.show("data uploaded.",2e3),console.log("finished data upload")}).catch(function(e){console.error(e),t.api.show("upload failed, please try again.",5e3)})}).catch(function(e){console.error(e),t.api.show("upload failed, please check your s3 configuration.",5e3),t.uploading=!1})}).catch(function(e){e.args?t.api.show(e.args[0]):t.api.show(e)})}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("md-content",[a("md-card",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}]},[a("md-card-header",[a("md-subheader",[e._v("Uploading")])],1),e._v(" "),a("md-card-content",[a("form",[a("div",{staticClass:"md-layout",attrs:{"md-align":"begin"}},[a("p",[e._v("Uploading: "+e._s(e.selected_file_name))])]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"md-layout",attrs:{"md-vertical-align":"end"}},[a("input",{ref:"select_file_input",staticClass:"md-file",attrs:{type:"file"},on:{change:e.fileSelected}})])]),e._v(" "),e.uploading?a("div",{attrs:{layout:"row"}},[a("md-progress-bar",{attrs:{"md-value":e.upload_prgress}}),e._v(" "),a("p",[e._v(e._s(e.uploading?"please wait, this may take a while.":"")+" ")])],1):e._e()])],1),e._v(" "),a("br",{directives:[{name:"show",rawName:"v-show",value:e.uploading,expression:"uploading"}]}),e._v(" "),a("md-subheader",[e._v("Files")]),e._v(" "),a("md-table",{attrs:{"md-card":""}},[a("md-table-toolbar",{attrs:{slot:"md-table-alternate-header"},slot:"md-table-alternate-header"},[a("div",{staticClass:"md-toolbar-section-start"},[a("md-button",{staticClass:"md-primary",on:{click:e.update_file_list}},[a("md-icon",{staticClass:"md-primary"},[e._v("refresh")]),e._v("Refresh")],1)],1),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-icon-button"},[a("md-icon",{staticClass:"md-accent"},[e._v("delete")])],1)],1)]),e._v(" "),a("md-table-row",[a("md-table-head",{staticClass:"table-head-checkbox"},[a("md-checkbox",{staticClass:"table-head-checkbox"},[e._v("Select all")])],1),e._v(" "),a("md-table-head",[e._v("Name")]),e._v(" "),a("md-table-head",[e._v("Tags")]),e._v(" "),a("md-table-head",[e._v("Size")]),e._v(" "),a("md-table-head",[e._v("Actions")])],1),e._v(" "),e._l(e.file_list,function(t){return a("md-table-row",{key:t.key},[a("md-table-cell",[a("md-checkbox",{model:{value:t.select,callback:function(a){e.$set(t,"select",a)},expression:"file.select"}})],1),e._v(" "),a("md-table-cell",[e._v(e._s(t.name))]),e._v(" "),a("md-table-cell",[a("md-chips",{scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n              "+e._s(a)+"\n            ")]}}]),model:{value:t.tags,callback:function(a){e.$set(t,"tags",a)},expression:"file.tags"}})],1),e._v(" "),a("md-table-cell",[e._v(e._s(t.size))]),e._v(" "),a("md-table-cell",[a("md-menu",{attrs:{"md-size":"medium"}},[a("md-button",{staticClass:"md-primary md-icon-button",attrs:{"md-menu-trigger":""}},[a("md-icon",[e._v("more_horiz")])],1),e._v(" "),a("md-menu-content",[a("md-menu-item",[a("md-button",{staticClass:"md-primary",on:{click:function(a){e.remove_file(t.key)}}},[a("md-icon",[e._v("trash")]),e._v("delete")],1)],1),e._v(" "),a("md-menu-item",[a("md-button",{staticClass:"md-primary",on:{click:function(a){e.rename_file(t.key)}}},[a("md-icon",[e._v("pen")]),e._v("rename")],1)],1)],1)],1)],1)],1)})],2)],1)},staticRenderFns:[]};var F=a("VU/8")(A,D,!1,function(e){a("9+ik")},"data-v-310a71fb",null).exports,z={name:"repository",props:{title:{type:String,default:"Repository"},showTags:{type:Boolean,default:!0}},data:function(){return{selected_tag:"all",last_sample_filter:null,sample_filter:{tags:{$nin:["deprecated"]}},tag_list:[],selected_sample:null,showInfoDialog:!1,showRemoveConfirm:!1,loading_public_samples:!1,public_sample_list:[],url_prefix:"",page_no:0,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");this.url_prefix=e+"/#/view?u=",this.store.connected?(this.update_tag_list(),this.update_public_sample_list()):(this.store.event_bus.$on("connected",this.update_public_sample_list),this.store.event_bus.$on("connected",this.update_tag_list))},methods:{downloadFile:function(e,t){var a=this,s={};e.public&&e.public_uuid?s.public_uuid=e.public_uuid:(s.hash=e.hash,s.shared_token=e.shared_token),this.store.session.call("org.imod.public.get_shared_sample_file",[s,t.hash],{},{disclose_me:!0}).then(function(t){console.log("file url",t.url);var a=document.createElement("a"),s=e.name;s.endsWith(".smlm")||s.endsWith(".zip")||(s+=".smlm"),a.setAttribute("href",t.url),a.setAttribute("download",s),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a)}).catch(function(e){console.error(e),a.api.show(e.args[0]),reject(e)})},filter_tag:function(e){this.sample_filter=e?{tags:e}:{tags:{$nin:["deprecated"]}},this.update_public_sample_list()},prev_page:function(){0!=this.page_no&&(this.page_no=this.page_no-1,this.$router.push({path:"/repository",query:{page:this.page_no}}),this.update_public_sample_list())},next_page:function(){this.page_no=this.page_no+1,this.$router.push({path:"/repository",query:{page:this.page_no}}),this.update_public_sample_list()},update_tag_list:function(){var e=this;console.log("updating tags"),this.available_tags=[],this.store.session.call("org.imod.public.get_tag_list",[{public:!0}],{},{disclose_me:!0}).then(function(t){e.api.show("tag list updated."),e.tag_list=t}).catch(function(t){console.log(t),e.api.show(t)})},update_public_sample_list:function(){var e=this;console.log(this.$route.query),this.$route.query.page&&(this.page_no=parseInt(this.$route.query.page)),this.loading_public_samples||(this.loading_public_samples=!0,this.public_sample_list=[],this.store.session.call("org.imod.public.get_sample_list",[this.sample_filter,this.page_no],{},{disclose_me:!0,receive_progress:!0}).then(function(){e.last_sample_filter=e.sample_filter,e.loading_public_samples=!1,e.api.show("public sample list updated.")},function(){console.log(err),e.api.show(err),e.loading_public_samples=!1},function(t){e.public_sample_list.push(t)}).catch(function(e){}))},remove_sample:function(e){var t=this;this.store.session.call("org.imod.admin.samples.remove_sample",[e],{},{disclose_me:!0}).then(function(a){t.api.show("sample '"+e.$oid+"' is removed."),t.update_public_sample_list()}).catch(function(e){console.log(e),t.api.show(e)})}}},$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"repository"},[e.title?a("md-subheader",[e._v(e._s(e.title))]):e._e(),e._v(" "),e.title?a("md-divider"):e._e(),e._v(" "),e.showTags?a("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[a("p",[e._v("Tag filter:")]),e._v(" "),a("md-chip",{class:"all"==e.selected_tag?"md-primary":"",attrs:{"md-static":"","md-clickable":""},on:{click:function(t){e.filter_tag(),e.selected_tag="all"}}},[e._v("\n      all\n    ")]),e._v(" "),e._l(e.tag_list,function(t){return a("md-chip",{key:t._id,class:e.selected_tag==t._id?"md-primary":"",attrs:{"md-static":"","md-clickable":""},on:{click:function(a){e.filter_tag(t._id),e.selected_tag=t._id}}},[e._v("\n      "+e._s(t._id)),a("md-tooltip",[e._v(e._s(t.count)+" samples")])],1)})],2):e._e(),e._v(" "),e.title?a("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[a("p",[e._v("Reminder: except where otherwise noted, public data on this site is licensed under a "),a("a",{attrs:{href:"https://creativecommons.org/licenses/by/4.0/",target:"_blank"}},[e._v("Creative Commons Attribution 4.0 International license.")])])]):e._e(),e._v(" "),a("div",{staticClass:"md-layout md-gutter md-alignment-top-center"},[!e.loading_public_samples&&e.public_sample_list.length<=0?a("md-empty-state",{attrs:{"md-icon":"info_outline","md-label":"No sample available on this page.","md-description":""}}):e._e(),e._v(" "),e._l(e.public_sample_list,function(t){return a("md-card",{key:t._id.$oid,staticClass:"sample-card"},[a("md-card-media",{attrs:{"md-ratio":"16:9"}},[a("a",{attrs:{target:"_blank",href:e.url_prefix+t.public_uuid}},[a("img",{staticClass:"thumbnail-img",attrs:{src:t.thumbnail,alt:t.name}})])]),e._v(" "),a("md-card-area",[a("md-card-header",[a("md-chips",{staticClass:"tags-chip",attrs:{"md-static":""},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n               "+e._s(a)+"\n             ")]}}]),model:{value:t.tags,callback:function(a){e.$set(t,"tags",a)},expression:"sample.tags"}}),e._v(" "),a("p",[e._v(e._s(t.name.slice(0,30)+(t.name&&t.name.length>30?"...":"")))])],1),e._v(" "),a("md-card-actions",[a("span",{staticClass:"md-title"},[e._v("#"+e._s(e._f("truncate")(t.hash,12)))]),e._v(" "),a("md-button",{attrs:{href:e.url_prefix+t.public_uuid,target:"_blank"}},[e._v("Open")]),e._v(" "),a("md-button",{staticClass:"md-primary md-icon-button",on:{click:function(a){e.selected_sample=t,e.showInfoDialog=!0}}},[a("md-icon",[e._v("more_horiz")])],1)],1)],1)],1)}),e._v(" "),a("br")],2),e._v(" "),e.loading_public_samples?a("div",{staticClass:"md-layout md-alignment-center-center"},[a("md-progress-spinner",{attrs:{"md-diameter":100,"md-stroke":10,"md-mode":"indeterminate"}})],1):e._e(),e._v(" "),a("br"),e._v(" "),a("md-toolbar",{staticClass:"md-transparent md-dense md-layout-item",attrs:{"md-elevation":"0"}},[a("div",{staticClass:"md-toolbar-row md-layout md-gutter md-alignment-top-center",attrs:{flex:""}},[a("md-button",{staticClass:"md-primary",attrs:{disabled:0==e.page_no},on:{click:e.prev_page}},[e._v("Previous Page")]),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{disabled:0==e.public_sample_list.length},on:{click:e.next_page}},[e._v("Next Page")])],1)]),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showInfoDialog},on:{"update:mdActive":function(t){e.showInfoDialog=t}}},[a("md-dialog-content",[a("div",{staticClass:"md-layout-row md-gutter"},[e.selected_sample?a("div",{staticClass:"md-flex"},[a("p",[e._v("Name: "+e._s(e.selected_sample.name))]),e._v(" "),a("p",[e._v("Description: "+e._s(e.selected_sample.description)+" ")]),e._v(" "),a("p",[e._v("Uploaded by: "+e._s(e.selected_sample.owner))]),e._v(" "),a("p",[e._v("UserID: "+e._s(e.selected_sample.uid))]),e._v(" "),e.selected_sample.citeAs?a("p",[e._v("Cite as: "+e._s(e.selected_sample.citeAs))]):e._e(),e._v(" "),e.selected_sample.license?a("p",[e._v("License: "+e._s(e.selected_sample.license))]):e._e(),e._v(" "),a("p",[e._v("Tags:")]),e._v(" "),a("md-chips",{attrs:{"md-static":""},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n             "+e._s(a)+"\n           ")]}}]),model:{value:e.selected_sample.tags,callback:function(t){e.$set(e.selected_sample,"tags",t)},expression:"selected_sample.tags"}}),e._v(" "),a("br"),e._v(" "),a("md-divider"),e._v(" "),a("span",{staticClass:"md-list-item-text"},[e._v("Files (click to download)")]),e._v(" "),e.selected_sample.files?a("md-list",e._l(e.selected_sample.files,function(t,s){return a("md-list-item",{key:s,staticClass:"md-primary",on:{click:function(a){e.downloadFile(e.selected_sample,t)}}},[e._l(t.tags,function(t){return a("md-chip",{key:t},[e._v(e._s(t))])}),e._v(e._s(t.name))],2)})):e._e()],1):e._e()])]),e._v(" "),a("md-dialog-actions",["admin"==e.store.authrole?a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1,e.showRemoveConfirm=!0}}},[e._v("Remove Plublic Sample")]):e._e(),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1}}},[e._v("OK")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),"admin"==e.store.authrole?a("md-dialog-confirm",{attrs:{"md-active":e.showRemoveConfirm,"md-title":"Delete confirmation","md-content":"Are you sure to remove this sample?","md-confirm-text":"Yes","md-cancel-text":"Cancel"},on:{"update:mdActive":function(t){e.showRemoveConfirm=t},"md-cancel":function(t){e.showSConfirm=!1},"md-confirm":function(t){e.showSConfirm=!1,e.remove_sample(e.selected_sample._id)}}}):e._e(),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),e.title?a("md-divider"):e._e(),e._v(" "),e.title?a("main-footer"):e._e()],1)},staticRenderFns:[]};var E,T=a("VU/8")(z,$,!1,function(e){a("68C1")},"data-v-27474fb1",null).exports,R=a("//Fk"),M=a.n(R),I=a("fZjL"),U=a.n(I),W=a("woOf"),N=a.n(W),P=a("lDdF"),O=a("Xxa5"),B=a.n(O),j=a("exGp"),V=a.n(j),H=a("mvHQ"),Y=a.n(H),G=a("Zrlr"),q=a.n(G),Z=a("wxAW"),X=a.n(Z);var K,J,Q,ee,te,ae=function(){function e(t){q()(this,e),this.manifest=JSON.parse(Y()(oe)),this.formats=this.manifest.formats,this.files=this.manifest.files,this.channels={},this.zipFile=null,this.uploaded=!1,this.isSMLM=!1,this.manifest.license=this.manifest.license||"CC BY 4.0",this.manifest.tags=this.manifest.tags||[],this.manifest.citeAs=this.manifest.citeAs||""}return X()(e,[{key:"import_image",value:function(e,t,a,s,i){var n=this;return new M.a(function(i,o){console.log("import file",t);var r=new FileReader;r.onload=function(o){var r=new Image;r.addEventListener("load",function(){var o={};o.format=t,o.type="image",o.size=[r.height,r.width],N()(o,a);var l={};l.image=r,l.file=e,l.name=e.name,l.file_name=e.name,l.file_size=e.size,o.name=e.name,o.data=l;var d=n.calculate_hash(o);o.hash=d,o.tags=a.tags||[],o.pixel_size=a.pixel_size,l.file_hash=d,s||!n.files||0==n.files.length?n.files.push(o):(n.manifest=JSON.parse(Y()(oe)),n.formats=n.manifest.formats,n.files=n.manifest.files,n.files.push(o)),n.formats[t]=se[t],n.manifest.name&&""!=n.manifest.name||(n.isSMLM?n.manifest.name=e.name.split(".")[0]+".smlm":n.manifest.name=e.name.split(".")[0]+".zip"),n.manifest.hash||n.update_hash(),a.channel=a.channel||"default",n.channels[a.channel]=n.channels[a.channel]||[],n.channels[a.channel].push(l),n.zipFile=null,n.uploaded=!1,console.log(l),i(o)}),r.src=o.target.result},r.onerror=function(e){o(e)},r.readAsDataURL(e)})}},{key:"import_text_table",value:function(e,t,a,s,i){var n=this;return console.log(t),("string"==typeof t||t instanceof String)&&(t=ie[t]),new M.a(function(o,r){return t?"undefined"==typeof Worker?(console.log("Web Worker not available"),void r("Web Worker not available")):(l=new Worker("static/js/AsyncTextLoader.js"),console.log("loading..."),i({running:!0,running_status:"running "}),l.onmessage=function(t){var d=t.data;if(d.error)r(d.error),l.terminate();else if(d.loaded){console.log(d.tableDict),console.log("done",d.statshtml,d);var m=JSON.parse(Y()(re));d.name=e.name,d.file_size=e.size,m.name=e.name,m.type="table",m.rows=d.rows,m.min=d.min,m.max=d.max,m.avg=d.avg,m.offset={x:0,y:0},m.data=d;var c=n.calculate_hash(m);m.hash=c,d.file_hash=c,m.tags=a.tags||[],m.pixel_size=a.pixel_size,s?n.files.push(m):(n.manifest=JSON.parse(Y()(oe)),n.formats=n.manifest.formats,n.files=n.manifest.files,n.files.push(m)),n.manifest.name&&""!=n.manifest.name||(n.manifest.name=e.name.split(".")[0]+".smlm"),n.manifest.hash||n.update_hash(),a.channel=a.channel||"default",n.channels[a.channel]=n.channels[a.channel]||[],n.channels[a.channel].push(d),n.zipFile=null,n.uploaded=!1,n.isSMLM=!0,l.terminate(),console.log(d),o(m)}else d.progress&&i({running_progress:d.progress,running_status:(d.localization_num/1e6).toFixed(1)+"M localizations loaded"})},l.onerror=function(){console.log("load error"),r("error occured during running."),l.terminate()},void l.postMessage({file:e,format:t})):(console.log("no table format not found.",t),void r("no table format not found."));var l})}},{key:"import_smlm",value:function(e,t,a){var s=this;if(t)throw"please load smlm file first, append mode is not supported yet.";return new M.a(function(t,i){JSZip.loadAsync(e).then(function(n){a({running:!0});var o=n.file("manifest.json");o?o.async("string").then(function(o){var r=JSON.parse(o),l=r.format_version;a({running_status:"manifest file loaded."});var d,m={};(d=V()(B.a.mark(function t(){var i,o;return B.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=B.a.mark(function t(i){return B.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new M.a(function(t,o){var d=r.files[i];if("table"==d.type){a({running_status:"loading smlm file..."});var c=n.file(d.name),u=d.format;if(a({running_status:"uncompressing file: "+d.name}),!c&&r.formats[u])return void o("table file "+r.table_file+" is not present in the zip file");var _=r.formats[u];c.async("blob").then(function(i){console.log(i);var n=new FileReader;n.onload=function(i){a({running_status:"table loaded."});for(var n=i.target.result,r=new Uint8Array(n),c=d.rows,u=_.columns,p=0;p<u;p++)_.headers[p].startsWith("_")&&(_.headers[p]=_.headers[p].slice(1));if(r.length!=c*u*4)return console.error("file size mismatch: ",r.length,c*u*4),void o("file size does not match the manifest.");for(var h=[],f=[],g=0;g<u;g++)h[g]=new Uint8Array(new ArrayBuffer(4*c));if(1==l)for(var v=0;v<u;v++)for(var w=0;w<4*c;w++)h[v][w]=r[w*u+v];else for(var b=0;b<u;b++)for(var y=0;y<c;y++)h[b][4*y]=r[y*u*4+4*b],h[b][4*y+1]=r[y*u*4+4*b+1],h[b][4*y+2]=r[y*u*4+4*b+2],h[b][4*y+3]=r[y*u*4+4*b+3];for(var k={},x={},C=0;C<u;C++)f[C]=new Float32Array(h[C].buffer),k[_.headers[C]]=f[C],x[_.headers[C]]=h[C];d.min={},d.max={},d.avg={},c=f[0].length;for(var S=0;S<u;S++){var A=_.headers[S];d.min[A]=Number.POSITIVE_INFINITY,d.max[A]=Number.NEGATIVE_INFINITY,d.avg[A]=0;for(var D=0;D<c;D++)d.min[A]>f[S][D]&&(d.min[A]=f[S][D],0==f[S][D]&&console.log(A,S,D)),d.max[A]<f[S][D]&&(d.max[A]=f[S][D]),d.avg[A]+=f[S][D]/c}m.headers=_.headers;for(var F=0;F<m.headers.length;F++)m.headers[F]=m.headers[F].replace(/[^a-zA-Z0-9]+/g,"_").trim();m.min=d.min,m.max=d.max,m.avg=d.avg,m.file_name=d.name,m.file_size=e.size,m.tableUint8Arrays=h,m.tableArrays=f,m.tableUint8Dict=x,m.tableDict=k,m.columns=u,N()(m,d),d.data=m,d.data.integrity_test=!1;var z=s.calculate_hash(d);d.hash&&d.hash==z?(d.data.integrity_test=!0,console.log("integrity test passed: hash = "+z)):(d.data.integrity_test=!1,console.log("integrity test failed: hash "+d.hash+" != "+z)),d.hash=z,m.file_hash=z,t()},n.onerror=function(e){o(e)},n.readAsArrayBuffer(i)}).catch(function(e){o(e)})}else if("image"==d.type){a({running_status:"loading image file..."});d.format;var p=n.file(d.name);if(!p)return void o("image file "+r.image_file+" is not present in the zip file.");a({running_status:"uncompressing file: "+d.name}),p.async("blob").then(function(a){var s=new FileReader;s.onload=function(s){var i=new Image;i.addEventListener("load",function(){var s={};s.image=i,s.name=d.name||e.name,s.file_name=d.name||e.name,s.file_size=a.size||e.size,s.file_hash=d.hash,d.data=s,t()}),i.src=s.target.result},s.onerror=function(e){o(e)},s.readAsDataURL(a)})}});case 2:case"end":return t.stop()}},t,s)}),o=0;case 2:if(!(o<r.files.length)){t.next=7;break}return t.delegateYield(i(o),"t0",4);case 4:o++,t.next=2;break;case 7:case"end":return t.stop()}},t,s)})),function(){return d.apply(this,arguments)})().then(function(){s.formats=r.formats,s.files=r.files,s.manifest=r,s.manifest.tags=s.manifest.tags||[],s.update_hash(),s.zipFile=null,s.uploaded=!1,s.isSMLM=!0,t(s.files)}).catch(function(e){i(e)})}).catch(function(e){i(e)}):i("manifest.json is not present in the zip file")})})}},{key:"calculate_hash",value:function(e){console.log("calculating md5 for ",e.name);var t=new SparkMD5.ArrayBuffer;if("table"==e.type){var a=e.data.tableDict;a.frame&&t.append(a.frame.buffer),a.x&&t.append(a.x.buffer),a.y&&t.append(a.y.buffer)}else if("image"==e.type){var s=e.data.image.src,i=this.dataURItoArrayBuffer(s);t.append(i)}var n=t.end();return console.log(e.name," hash: ",n),n}},{key:"update_hash",value:function(){for(var e=new SparkMD5,t=0;t<this.files.length;t++)this.files[t].hash?e.append(this.files[t].hash):e.append(this.files[t].name);this.manifest.hash=e.end(),console.log("update smlm file hash, name: ",this.manifest.name+" md5: "+this.manifest.hash)}},{key:"dataURItoArrayBuffer",value:function(e){for(var t=atob(e.split(",")[1]),a=(e.split(",")[0].split(":")[1].split(";")[0],new ArrayBuffer(t.length)),s=new Uint8Array(a),i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return a}},{key:"dataURItoFile",value:function(e,t){for(var a=atob(e.split(",")[1]),s=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(a.length),n=new Uint8Array(i),o=0;o<a.length;o++)n[o]=a.charCodeAt(o);var r=new Blob([i],{type:s}),l=t.split(".")[0]+"."+(s.split("/")[1]||"png");return new File([r],l)}},{key:"save",value:function(e){var t=this;return console.log("preparing .smlm file"),new M.a(function(a,s){try{if(t.zipFile)return void a(t.zipFile);var i=new JSZip;e({running:!0,running_progress:0,running_status:"Preparing a compressed smlm file..."});for(var n=0;n<t.files.length;n++){var o=t.files[n];if("table"==o.type){for(var r=JSON.parse(Y()(ne["smlm-table(binary)"])),l=r.name+"-"+n,d=t.files[n].data,m=d.tableDict,c=[],u=0;u<d.headers.length;u++)c.push(new Uint8Array(m[d.headers[u]].buffer));var _=c[0].length/4,p=c.length;r.name=l,o.format=l,t.formats[l]=r,o.name=d.file_name.split(".")[0]+r.extension,o.hash=t.calculate_hash(o),r.columns=p;for(var h=0;h<d.headers.length;h++)r.dtype[h]="float32",r.shape[h]=1,r.headers[h]=d.headers[h].replace(/'/g,"").replace(/"/g,"").replace(/[^a-zA-Z0-9]+/g,"_").trim(),r.headers[h].startsWith("_")&&(r.headers[h]=r.headers[h].slice(1));console.log("preparing table ",o.name);var f=new ArrayBuffer(_*p*4),g=new Uint8Array(f);console.log("binary file size: "+_*p*4);for(var v=0;v<p;v++)for(var w=0;w<_;w++)g[w*p*4+4*v]=c[v][4*w],g[w*p*4+4*v+1]=c[v][4*w+1],g[w*p*4+4*v+2]=c[v][4*w+2],g[w*p*4+4*v+3]=c[v][4*w+3];var b=new Blob([g]),y=new File([b],o.name,{type:"application/octet-stream",lastModified:Date.now()});console.log("file is ready.",y),console.log("preparing file for upload..."),i.file(o.name,y)}else if("image"==o.type){var k=t.files[n].data,x=k.image.src,C=t.dataURItoFile(x,k.file_name);o.hash=t.calculate_hash(o),i.file(C.name,C)}}var S=N()({},t.manifest);S.format_version=oe.format_version;for(var A=[],D=0;D<t.manifest.files.length;D++){var F=N()({},t.manifest.files[D]);delete F.data,A.push(F)}S.files=A,t.update_hash(),console.log("smlm manifest: ",S),i.file("manifest.json",Y()(S,null,"\t")),console.log("making zip archive..."),i.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}},function(t){e({running_status:"making zip files... ",running_progress:t.percent})}).then(function(e){var s=t.manifest.name,i=new File([e],s,{type:"application/smlm",lastModified:Date.now()});console.log(i),t.zipFile=i,a(i)}).catch(function(e){console.error(e),s(e)})}catch(e){return console.error(e),void s(e)}})}}]),e}(),se={png:{type:"image",extension:".png",mode:"binary"},jpg:{type:"image",extension:".jpg",mode:"binary"},jpeg:{type:"image",extension:".jpeg",mode:"binary"}},ie={"ThunderSTORM (csv)":{type:"table",extension:".csv",mode:"text",dtype:"float32",delimiter:",",comments:"",header_row:0,header_transform:{"x [nm]":"x","y [nm]":"y","z [nm]":"z","uncertainty_xy [nm]":"uncertainty_xy","uncertainty_z [nm]":"uncertainty_z"},name:"ThunderSTORM (csv)",description:"a csv format used in thunderSTORM"},"ThunderSTORM (xls)":{type:"table",extension:".xls",mode:"text",dtype:"float32",delimiter:"\t",comments:"",header_row:0,header_transform:{"x [nm]":"x","y [nm]":"y","z [nm]":"z","uncertainty_xy [nm]":"uncertainty_xy","uncertainty_z [nm]":"uncertainty_z"},name:"ThunderSTORM (xls)",description:"a xls format used in thunderSTORM"},"ZEISS (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:"\t",comments:"",header_row:0,header_transform:{"Position X [nm]":"x","Position Y [nm]":"y","Position Z [nm]":"z","First Frame":"frame"},name:"ZEISS (txt)",description:"a txt format used in ZEISS microscope"},"ZEISSv1 (csv)":{type:"table",extension:".csv",mode:"text",dtype:"float32",delimiter:";",comments:"",header_row:0,header_transform:{"Position X [nm]":"x","Position Y [nm]":"y","Position Z [nm]":"z","First Frame":"frame"},name:"ZEISSv1 (csv)",description:"a csv format used in ZEISS microscope"},"ZEISSv2 (csv)":{type:"table",extension:".csv",mode:"text",dtype:"float32",delimiter:";",comments:"",header_row:0,header_transform:{"x [nm]":"x","y [nm]":"y","z [nm]":"z","First Frame":"frame"},name:"ZEISSv2 (csv)",description:"a csv format used for ZEISS microscope"},"RapidSTORM (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:" ",comments:"",header_row:0,header_transform:{"*all*":'identifier="([\\w\\d\\-_]+)"',"Position-0-0":"x","Position-1-0":"y","Position-2-0":"z","ImageNumber-0-0":"frame"},name:"RapidSTORM (txt)",description:"a text format used in RapidSTORM"},"Space Seperated List (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:" ",comments:"",header_row:0,header_transform:{},name:"Space Seperated List (txt)",description:"A list of coordinates seperated with space."},"Nikon NSTORM (txt)":{type:"table",extension:".txt",mode:"text",dtype:"float32",delimiter:"\t",comments:"",header_row:0,header_transform:{X:"x",Y:"y",Z:"z",Frame:"frame"},name:"Nikon NSTORM (txt)",description:"a txt format exported from Nikon NSTORM software"}},ne={"smlm-table(binary)":(E={name:"smlm-table(binary)",type:"table",mode:"binary",extension:".bin",columns:0,headers:[],dtype:[],shape:[],units:[]},b()(E,"name","smlm-table(binary)"),b()(E,"description","the default smlm format for localization tables"),E),"smlm-image(binary)":{type:"image",mode:"binary",extension:".raw",dtype:"uint32",shape:[512,512,null],offset:0,name:"smlm-image(binary)",description:"a format for 32-bit raw pixel image"},"smlm-table(csv)":{type:"table",mode:"text",extension:".csv",dtype:"float32",delimiter:",",comments:"#",header_row:0,header_transform:{},name:"smlm-table(csv)",description:"a format for export as csv format"}},oe={format_version:"0.2",formats:{},files:[],tags:[],name:"",description:"",sample:"",labeling:""},re={name:"",format:"smlm-table(binary)",channel:"default",rows:0,offset:{},metadata:{},exposure:-1},le={"shader-particle-renderer-vs":{type:"x-shader/x-vertex",source:"#ifdef GL_ES\n  precision mediump float;\n  #endif\n  attribute vec2 uv;\n\n  uniform sampler2D sampler_particles;\n\n  uniform vec2 viewSize;\n  uniform vec4 scale;\n  uniform vec4 color1;\n  uniform vec2 clipX;\n  uniform vec2 clipY;\n  uniform vec2 clipZ;\n\n  uniform mat4 projectionMatrix;\n  uniform mat4 modelViewMatrix;\n\n  uniform float fov;\n  uniform vec3 camera;\n  uniform float pointSizeMin;\n  uniform float pointSizeMax;\n\n  varying vec4 col;\n  varying float alphaFactor;\n\n  void main() {\n  \tvec4 pos = texture2D(sampler_particles, uv);\n  \tbool isVisible = clipX.x - 0.5 <= pos.x && pos.x <= clipX.y - 0.5 && clipY.x - 0.5 <= pos.y && pos.y <= clipY.y - 0.5 && clipZ.x - 0.5 <= pos.z && pos.z <= clipZ.y - 0.5;\n  \tpos.xyz += -vec3(clipX.x + clipX.y, clipY.x + clipY.y, clipZ.x + clipZ.y)*0.5 + 0.5;\n  \tpos.xyz *= scale.xyz;\n\n  \tfloat distance = length(camera-(modelViewMatrix * pos).xyz);\n  \tgl_PointSize = scale.w*fov/distance*viewSize.y/2048.;\n\n  \talphaFactor = 1.;\n  \tif(gl_PointSize < 1.){\n  \t\talphaFactor = max(gl_PointSize, 1./16.);\n  \t}\n\n  \tcol = color1;\n\n  \tpos.w = 1.;\n  \tgl_Position = projectionMatrix  * modelViewMatrix * pos;\n\n  \tif(!isVisible){\n  \t\tcol.a = 0.;\n  \t}}"},"shader-vs":{type:"x-shader/x-vertex",source:"#ifdef GL_ES\n    precision mediump float;\n    #endif\n    attribute vec3 aPos;\n    attribute vec2 aTexCoord;\n    varying   vec2 uv;\n    varying vec2 uv_orig;\n    void main(void) {\n    \t gl_Position = vec4(aPos, 1.);\n    \t uv = aTexCoord;\n    \t uv_orig = uv;\n    }"},"shader-particle-renderer-fs":{type:"x-shader/x-fragment",source:"#ifdef GL_ES\n    precision mediump float;\n    #endif\n    varying vec4 col;\n    varying float alphaFactor;\n\n    void main() {\n    \tgl_FragColor = col;\n    \tgl_FragColor.a *= alphaFactor;\n    }"}};function de(e,t){var a,s=le[t];if("x-shader/x-fragment"==s.type)a=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!=s.type)return null;a=e.createShader(e.VERTEX_SHADER)}return e.shaderSource(a,s.source),e.compileShader(a),0==e.getShaderParameter(a,e.COMPILE_STATUS)&&alert("error compiling shader '"+t+"'\n\n"+e.getShaderInfoLog(a)),a}var me,ce,ue,_e,pe,he,fe,ge,ve,we=512,be=512,ye=1024,ke=512,xe=ye,Ce=ke,Se=0,Ae=(new Date).getTime(),De=function(){this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.pointSize=1,this.distance=4,this.fov=16,this.pointSizeMin=0,this.pointSizeMax=12};function Fe(){xe=window.innerWidth,Ce=window.innerHeight,ve.width=xe,ve.height=Ce;var e=xe/Ce;ce=new THREE.PerspectiveCamera(75,e,.1,1e4),ue=new THREE.Scene,_e=new THREE.Object3D,ue.add(ce),ue.add(_e),ce.lookAt(_e),Ye(),pe=new THREE.TrackballControlsWithPropagation(ce,ve),_e.position.set(0,0,0),ce.position.set(0,0,fe.distance),ce.fov=fe.fov,ce.projectionMatrix=(new THREE.Matrix4).makePerspective(ce.fov,window.innerWidth/window.innerHeight,ce.near,ce.far),pe.rotateSpeed=1,pe.zoomSpeed=1.2,pe.panSpeed=.8,pe.dynamicDampingFactor=.15}var ze=!1;function $e(){Oe=0,fe["Total # of locations"]=0;for(var e=0;e<Ze.length;e++){fe["active "+e]&&fe["alpha "+e]>0&&(Oe+=qe[Ze[e]].locations.numChunks,fe["Total # of locations"]+=qe[Ze[e]].locations.rows);var t=fe["color "+e];if("string"==typeof t){var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);fe["color "+e]=[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}}ze=!0}function Ee(e,t){ge=t,fe=new De,he=new dat.GUI({autoPlace:!1}),document.getElementById("gui-webgl").appendChild(he.domElement),fe["Total # of locations"]=0,fe["reset scale"]=function(){fe.x=1,fe.y=1,fe.z=1,fe["point size"]=3,ze=!0},fe["reset scale"]();var a=he.addFolder("Scale (x10)");a.add(fe,"x",0,10).listen().onChange($e),a.add(fe,"y",0,10).listen().onChange($e),a.add(fe,"z",0,10).listen().onChange($e),a.add(fe,"point size",0,20).listen().onChange($e),a.add(fe,"reset scale"),fe["reset clipping"]=function(){fe["x min"]=0,fe["x max"]=1,fe["y min"]=0,fe["y max"]=1,fe["z min"]=0,fe["z max"]=1,ze=!0},fe["reset clipping"]();var s=he.addFolder("Clipping");s.add(fe,"x min",0,1).listen().onChange($e),s.add(fe,"x max",0,1).listen().onChange($e),s.add(fe,"y min",0,1).listen().onChange($e),s.add(fe,"y max",0,1).listen().onChange($e),s.add(fe,"z min",0,1).listen().onChange($e),s.add(fe,"z max",0,1).listen().onChange($e),s.add(fe,"reset clipping"),he.add(fe,"Total # of locations").listen(),ve=e;try{K=ve.getContext("webgl",{depth:!1,preserveDrawingBuffer:!0})}catch(e){}if(K)if(["OES_texture_float"].forEach(function(e){console.log("check "+e);try{J=K.getExtension(e)}catch(e){alert(e)}J?J=!1:alert("Meh! Y u no support "+e+" !?!")}),0!=K.getParameter(K.MAX_VERTEX_TEXTURE_IMAGE_UNITS)){qe=[],Ze=[],document.addEventListener("orientationchange",window.onresize=Fe),window.addEventListener("DOMMouseScroll",Qe,!1),window.addEventListener("mousewheel",Qe,!1),Fe(),K.bindBuffer(K.ARRAY_BUFFER,K.createBuffer());var i=1/512,n=new ArrayBuffer(4194304);n.float32=new Float32Array(n);for(var o=0;o<512;o++)for(var r=0;r<512;r++)n.float32[2*(512*o+r)+0]=i/2+r*i,n.float32[2*(512*o+r)+1]=i/2+o*i;var l=new ArrayBuffer(4194304);l.float32=new Float32Array(l),ee=K.createFramebuffer(),te=Te(l.float32,ee);Q=function(e){var t=K.createProgram();return K.attachShader(t,de(K,"shader-particle-renderer-vs")),K.attachShader(t,de(K,"shader-particle-renderer-fs")),K.bindAttribLocation(t,e,"uv"),K.linkProgram(t),t}(1),K.useProgram(Q),K.uniform1i(K.getUniformLocation(Q,"sampler_particles"),0),K.enableVertexAttribArray(1),me=K.createBuffer(),K.bindBuffer(K.ARRAY_BUFFER,me),K.bufferData(K.ARRAY_BUFFER,n.float32,K.STATIC_DRAW),K.vertexAttribPointer(1,2,K.FLOAT,!1,8,0),setInterval(Je,1e3),(new Date).getTime()-Ae,K.blendFunc(K.SRC_ALPHA,K.ONE),K.blendEquation(K.FUNC_ADD),K.clearColor(0,0,0,1),Pe()}else alert("Meh! Y u no support vertex shader textures !?!");else alert("Meh! Y u no support WebGL !?!")}function Te(e,t){var a=K.createTexture();return K.bindTexture(K.TEXTURE_2D,a),K.pixelStorei(K.UNPACK_ALIGNMENT,1),K.texImage2D(K.TEXTURE_2D,0,K.RGBA,we,be,0,K.RGBA,K.FLOAT,e),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.NEAREST),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.NEAREST),K.bindFramebuffer(K.FRAMEBUFFER,t),K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,a,0),Ie(),a}var Re=!1;function Me(){Re=!0}function Ie(){var e=K.checkFramebufferStatus(K.FRAMEBUFFER);if(e!=K.FRAMEBUFFER_COMPLETE)for(var t in console.log("Framebuffer, y u not completed yet!?"),K)"number"==typeof K[t]&&K[t]==e&&console.log("-> "+t)}var Le=new Float32Array(16),Ue=0,We=new Float32Array(16),Ne=!0;function Pe(e){Ne,Ne=!0;for(var t=0;t<16;t++)Ne=Ne&&Le[t]-ce._projectionMatrixArray[t]==0&&We[t]-ce._viewMatrixArray[t]==0;(Ne=Ne&&ce.fov==Ue)||(Ue=ce.fov,Le.set(ce._projectionMatrixArray),We.set(ce._viewMatrixArray)),function(){if(Re){var e=qe[Ze[Ze.length-1]].locations;K.activeTexture(K.TEXTURE1),K.bindTexture(K.TEXTURE_2D,te),K.bindFramebuffer(K.FRAMEBUFFER,ee),K.texImage2D(K.TEXTURE_2D,0,K.RGBA,we,be,0,K.RGBA,K.FLOAT,e.stridedFloat32Arrays[1]),K.framebufferTexture2D(K.FRAMEBUFFER,K.COLOR_ATTACHMENT0,K.TEXTURE_2D,te,0),$e()}}(),pe.update(),Ye(),function(){K.viewport(0,0,xe,Ce),K.bindFramebuffer(K.FRAMEBUFFER,null);(ze||!Ne||Re)&&(K.clear(K.COLOR_BUFFER_BIT),K.flush(),je=-1);if(Ne&&-1==je&&!Re&&!ze||0==Oe)return void(ze=!1);ze=!1,K.bindBuffer(K.ARRAY_BUFFER,me),K.useProgram(Q),function(e){K.uniform2f(K.getUniformLocation(e,"viewSize"),xe,Ce),K.uniform2f(K.getUniformLocation(e,"aspect"),Math.max(1,xe/Ce),Math.max(1,Ce/xe)),K.uniform4f(K.getUniformLocation(e,"scale"),fe.x,fe.y,fe.z,fe["point size"]);var t=Math.min(fe["x min"],fe["x max"]),a=Math.max(fe["x min"],fe["x max"]);K.uniform2f(K.getUniformLocation(e,"clipX"),t,a);var s=Math.min(fe["y min"],fe["y max"]),i=Math.max(fe["y min"],fe["y max"]);K.uniform2f(K.getUniformLocation(e,"clipY"),s,i);var n=Math.min(fe["z min"],fe["z max"]),o=Math.max(fe["z min"],fe["z max"]);K.uniform2f(K.getUniformLocation(e,"clipZ"),n,o),K.uniform1f(K.getUniformLocation(e,"fov"),1/Math.tan(fe.fov/180*Math.PI)),K.uniform3f(K.getUniformLocation(e,"camera"),0,0,fe.distance),K.uniform1i(K.getUniformLocation(e,"sampler_particles"),1)}(Q),K.uniformMatrix4fv(K.getUniformLocation(Q,"projectionMatrix"),!1,ce._projectionMatrixArray),K.uniformMatrix4fv(K.getUniformLocation(Q,"modelViewMatrix"),!1,ce._viewMatrixArray),K.enable(K.BLEND),K.activeTexture(K.TEXTURE1);var e=0;e:for(var t=0;t<Ze.length;t++){var a=qe[Ze[t]],s=a.locations.numChunks-1,i=fe["color "+t],n=fe["alpha "+t],o=fe["active "+t]&&n>0;if(o){K.uniform4f(K.getUniformLocation(Q,"color1"),i[0]/255,i[1]/255,i[2]/255,n);for(var r=0;r<a.locations.numChunks;r++){if(e>je){if(!(e<=je+Be&&e<Oe)){je=e-1;break e}var l=a.locations.textures[r];K.bindTexture(K.TEXTURE_2D,l);var d=a.locations.bufferLength;r==s&&(d=a.locations.rows-a.locations.bufferLength*s,je=-1),K.drawArrays(K.POINTS,0,d)}e++}}}K.disable(K.BLEND),K.flush()}(),e&&function(e){var t=e-He;if(He=e,Ne)return;t<1e3/Ve?Be+=.25:Be-=.25;Be=Math.max(Be,0),Be=Math.min(Be,Oe)}(e),requestAnimationFrame(Pe),Re=!1,Se++,0}var Oe=0,Be=0,je=-1,Ve=24,He=0;function Ye(){ue.updateMatrixWorld(),ce.matrixWorldInverse.getInverse(ce.matrixWorld),ce._viewMatrixArray||(ce._viewMatrixArray=new Float32Array(16)),ce.matrixWorldInverse.flattenToArray(ce._viewMatrixArray),ce._projectionMatrixArray||(ce._projectionMatrixArray=new Float32Array(16)),ce.projectionMatrix.flattenToArray(ce._projectionMatrixArray),_e.__webglInit||(_e._modelViewMatrix=new THREE.Matrix4,_e._objectMatrixArray=new Float32Array(16),_e._modelViewMatrixArray=new Float32Array(16)),_e.matrixWorld.flattenToArray(_e._objectMatrixArray),_e._modelViewMatrix.multiplyToArray(ce.matrixWorldInverse,_e.matrixWorld,_e._modelViewMatrixArray)}var Ge=[[0,255,0],[255,0,255],[0,0,255]],qe=[],Ze=[];function Xe(e){return e.hash&&e.hash.length>5?e.hash:e.name+"."+e.size}function Ke(e,t){for(var a=Date.now(),s=["x","y","z"],i=[],n=[],o=e.tableDict,r=e.isFiltered,l=r?Math.ceil(e.filteredRows/262144):Math.ceil(e.rows/262144),d=0;d<l;d++)i[d]=new ArrayBuffer(4194304),n[d]=new Float32Array(i[d]);var m=Math.max(e.max[s[0]]-e.min[s[0]],e.max[s[1]]-e.min[s[1]],e.max[s[2]]-e.min[s[2]]),c=(e.max[s[0]]-e.min[s[0]])/2,u=(e.max[s[1]]-e.min[s[1]])/2,_=(e.max[s[2]]-e.min[s[2]])/2;t&&t({rendering:!0,rendering_progress:0,rendering_status:"normalize into strided array chunks"});for(var p=-1,h=0,f=0;f<e.rows;f++){var g=Math.floor(100*f/(e.rows+1));if(g!=p&&(p=g,t&&t({rendering_progress:p})),!r||r[f]){var v=h-262144*(d=Math.floor(h/262144)),w=n[d];w[4*v+0]=(o[s[0]][f]-c)/m,w[4*v+1]=(o[s[1]][f]-u)/m,w[4*v+2]=(o[s[2]][f]-_)/m,w[4*v+3]=1,h+=1}}t&&t({rendering_status:"normalize into strided array chunks [ms]: "+(Date.now()-a)});var b={file_hash:e.file_hash,filteredRows:e.filteredRows,file_name:e.file_name,file_size:e.file_size,bufferLength:262144,numChunks:l,rows:e.rows,headers:e.headers,stridedArrayBuffers:i};console.log("normalize into strided array chunks [ms]: "+(Date.now()-a),b),function(e){if(e){var t={hash:e.file_hash,name:e.file_name,size:e.file_size},a=Xe(t),s=Ze.indexOf(a);s>=0&&(t=qe[a]),e.stridedFloat32Arrays=[],e.textures=[];for(var i=0;i<e.numChunks;i++)e.stridedFloat32Arrays[i]=new Float32Array(e.stridedArrayBuffers[i]),e.textures[i]=Te(e.stridedFloat32Arrays[i],ee);if(console.log(qe),t.locations=e,Oe+=e.numChunks,s>=0)Me();else{!function(e){var t=Xe(e);qe[t]=e,Ze.push(t)}(t),Me();var n=Ze.length%Ge.length;if(e.numChunks>0){var o=he.addFolder(e.file_name+" (#"+e.filteredRows+")"),r=Ze.indexOf(a),l="active "+r,d="color "+r,m="alpha "+r;fe[l]=!0,fe[d]=Ge[n],fe[m]=.9,o.add(fe,l).onChange($e),o.addColor(fe,d).onChange($e),o.add(fe,m,0,1).onChange($e),o.open()}console.log(qe,Ze),console.log("locations uploaded to WebGL textures:"),console.log(e)}Be=Oe}else console.log("something went wrong")}(b),t({rendering_status:"3D view rendered(loc.:"+e.filteredRows+", file:"+e.file_name+").",rendering_progress:100,rendering:!1})}function Je(){fe.Fps=Se,he.__controllers[0].updateDisplay(),ge&&ge({fps:Ne?0:Se,ppf:Ne?0:Math.floor(Be)+" x 256k"}),Se=0}function Qe(e){if(e.target==ve){e.preventDefault(),e.stopPropagation();ce.fov-=.0033*e.wheelDeltaY,ce.fov=Math.max(Math.min(ce.fov,130),1),ce.projectionMatrix=(new THREE.Matrix4).makePerspective(ce.fov,window.innerWidth/window.innerHeight,ce.near,ce.far),fe.fov=ce.fov}}var et=a("iW7V")();var tt={name:"viewer",props:["title"],data:function(){var e;return e={selected_s3_file:null,selected_smlm_file_hash:null,selected_smlm_file:null,filter_enabled:!1,expandActions:!1,menuVisible:!1,show_filter:!1,use_lut:!0,use_3d:!1,localizationNumber:0,frameNumber:0,histogram_image:null,rendering_status:"",rendering_progress:0,filter_expression:"",filter_tooltip:"",histogram_width:2560,histogram_height:2560,filter_ranges:{},selected_filter:null,selected_filter_max:0,selected_filter_min:0,rendering:!1,rendered:!1,render3d_loaded:!1,export_histogram_png:null,map:null,fps:0,ppf:0,selected_file:null,renderWorker:null,filterWorker:null,hist_table:[],options:null,showInfoDialog:!1,showShareDialog:!1,showFilesDialog:!1,showErrorDialog:!1,error_content:"error occured.",text_file_format:"",running_status:"",running:!1,running_progress:0},b()(e,"running",!1),b()(e,"smlm",null),b()(e,"channel_name","default"),b()(e,"pixel_size",20),b()(e,"offset_x",0),b()(e,"offset_y",0),b()(e,"offset_mode","min-max"),b()(e,"running_progress",0),b()(e,"selected_channel",0),b()(e,"tags",[]),b()(e,"metadata",{}),b()(e,"show_more_import_options",!1),b()(e,"append_mode",!1),b()(e,"showImportDialog",!1),b()(e,"get_shared_link",!0),b()(e,"make_public",!1),b()(e,"licenses",["CC BY 4.0","CC BY-NC 4.0","CC BY-SA 4.0","CC BY-ND 4.0"]),b()(e,"shared_link",""),b()(e,"showSharedLink",!1),b()(e,"loaded_sample",null),b()(e,"loading_shared_url",!1),b()(e,"shared_url_mode",!1),b()(e,"showProcessDialog",!1),b()(e,"openFilesCount",0),b()(e,"anet_running",!1),b()(e,"anet_taskid",null),b()(e,"screenWidth",0),b()(e,"show_anet_output",!1),b()(e,"anet_output_available",!1),b()(e,"anet_output_img",null),b()(e,"anet_output_sample_hash",null),b()(e,"current_render2d_config",{brightness:1}),b()(e,"hist_render2d_config",{brightness:1}),b()(e,"anet_render2d_config",{brightness:1}),b()(e,"supported_file_formats",{}),b()(e,"file_sample_lines",""),b()(e,"use_widefield",!1),b()(e,"widefield_available",!1),b()(e,"worker_list",[]),b()(e,"worker_validation_msg",null),b()(e,"file_tags",[]),b()(e,"selected_worker",null),b()(e,"selected_worker_uri",null),b()(e,"loading_worker_list",!1),b()(e,"leafletMap",null),b()(e,"_canvas_layer",null),b()(e,"_canvas_data",null),b()(e,"current_displaying",null),b()(e,"show140",!1),b()(e,"support140",!0),b()(e,"showUploading",!1),b()(e,"store",this.$root.$data.store),b()(e,"api",this.$root.$data.store.api),e},watch:{menuVisible:function(){var e=this;setTimeout(function(){e.$refs["filter-slider"]&&e.$refs["filter-slider"].refresh(),e.$refs["brightness-slider"]&&e.$refs["brightness-slider"].refresh(),e.leafletMap.invalidateSize(),e.$forceUpdate()},800)}},mounted:function(){var e=this;if(this.screenWidth=window.innerWidth,this.store.event_bus.$on("resize",function(t){e.screenWidth=t.width,console.log("window size changed.",t.width),t.width>1e3&&!e.menuVisible&&e.options?e.menuVisible=!0:t.width<=1e3&&e.menuVisible&&(e.menuVisible=!1)}),this.supported_file_formats={},N()(this.supported_file_formats,{"SMLM format":{}}),N()(this.supported_file_formats,ie),N()(this.supported_file_formats,se),"viewer"!=this.$route.path){this.filterWorker=new Worker("static/js/AsyncFilter.js"),this.renderWorker=new Worker("static/js/AsyncRenderer.js");var t=function(){!e.store.session||e.loading_shared_url||e.loaded_sample||(e.$route.query.sample&&e.$route.query.token||e.$route.query.u||"admin"==e.store.authrole&&e.$route.query.sample?(e.shared_url_mode=!0,e.$route.query.u?e.loadSample({public_uuid:e.$route.query.u}):e.loadSample({hash:e.$route.query.sample,shared_token:e.$route.query.token})):e.shared_url_mode=!1)};t(),this.store.signed_in?t():this.store.event_bus.$on("connected",t)}},methods:{workerSelected:function(e){this.selected_worker=null;for(var t=0;t<this.worker_list.length;t++)if(this.worker_list[t].uri==e){this.selected_worker=this.worker_list[t];break}},updateCanvas:function(){if(this.show_anet_output){this.current_render2d_config=this.anet_render2d_config;var e=this.anet_output_img,t=document.createElement("canvas");t.width=e.width,t.height=e.height,this.histogram_width=t.width,this.histogram_height=t.height;var a=t.getContext("2d");a.drawImage(e,0,0);var s=a.getImageData(0,0,t.width,t.height);this.render_canvas(s,this.current_render2d_config.brightness)}else this.current_render2d_config=this.hist_render2d_config,this.render_canvas(null,this.current_render2d_config.brightness)},shareFile:function(){var e=this;this.store.signed_in?this.generateThumbnail().then(function(){e.showShareDialog=!0,e.smlm&&(e.smlm.manifest.license=e.smlm.manifest.license||"CC BY 4.0")}).catch(function(t){console.error(t),e.api.show("something went wrong.",5e3),e.error_content="Failed to share this sample, something went wrong.",e.showErrorDialog=!0}):this.api.showLogin()},openFilesChange:function(e,t){t.length&&console.log(e,t)},getFileExtension:function(e){return/[.]/.exec(e)?/[^.]+$/.exec(e)[0]:void 0},loadSample:function(e){var t=this;this.loading_shared_url=!0,this.store.session.call("org.imod.public.get_shared_sample",[e],{},{disclose_me:!0}).then(function(e){console.log("sample loaded",e),t.loaded_sample=e,t.tags=e.tags.slice(),t.thumbnail=e.thumbnail;var a=e.hash||U()(e.files)[0];e.files[a]?t.loadS3File(e.files[a],a).then(function(){t.loading_shared_url=!1}).catch(function(e){console.error(e),t.api.show("Error occured during loading.",5e3),t.loading_shared_url=!1,t.error_content="Failed to load the sample, maybe it was removed.",t.showErrorDialog=!0,t.running_status="Error: Failed to load the sample, maybe it was removed."}):(t.api.show("Error: no file found in the sample.",5e3),t.loading_shared_url=!1,t.error_content="There is no file in the sample.",t.showErrorDialog=!0,t.running_status="Error: There is no file in the sample.")}).catch(function(e){console.error(e),t.error_content="Sample was not found.",t.showErrorDialog=!0,t.api.show(e.args[0],5e3),t.loading_shared_url=!1,t.running_status="Error: Sample was not found."})},loadS3File:function(e,t){var a=this;return new M.a(function(s,i){if(a.selected_s3_file!=t){var n={};a.loaded_sample.public&&a.loaded_sample.public_uuid?n.public_uuid=a.loaded_sample.public_uuid:(n.hash=a.loaded_sample.hash,n.shared_token=a.loaded_sample.shared_token),a.store.session.call("org.imod.public.get_shared_sample_file",[n,e.hash],{},{disclose_me:!0}).then(function(n){console.log("file url",n.url),o.a.get(n.url,{responseType:"blob"}).then(function(i){console.log(i);var n=i.data,o=n.name||e.name;a.selected_file_name=o,a.selected_file=n,"application/zip"==n.type||"application/smlm"==n.type||o&&o.endsWith(".smlm")?a.loadSmlm():a.loadFile(),a.tags=a.loaded_sample.tags.slice(),a.thumbnail=a.loaded_sample.thumbnail,a.selected_s3_file=t,s()}).catch(function(e){i(e)})}).catch(function(e){console.error(e),a.api.show(e.args[0]),i(e)})}else s()})},loadSmlmFile:function(e){console.log("loading ...",e),this.file_tags=e.tags,"table"==e.type?(this.options=N()({xy_range:[0,0,0,0],pixel_size:this.pixel_size,frame_range:[0,0]},e.data),this.reset_filters(),this.filter_enabled=!0):"image"==e.type?(this.options={},this.plotImage(e.data.image)):console.error("file type not supported",e),this.selected_smlm_file_hash=e.hash,this.selected_smlm_file=e},generateThumbnail:function(e){var t=this;return new M.a(function(a,s){var i=null;if(t.use_3d)return t.api.show("Please switch to 2D mode to generate a thumbnail image for sharing."),void s();if(!t._canvas_data)return t.api.show("No data available."),void s();(i=document.createElement("canvas")).width=t.histogram_width,i.height=t.histogram_height,i.getContext("2d").putImageData(t._canvas_data,0,0);var n=document.createElement("canvas");n.width=e||192,n.height=n.width*(i.height/i.width),et.resize(i,n,{unsharpAmount:80,unsharpRadius:.6,unsharpThreshold:2}).then(function(e){t.smlm.manifest.thumbnail=n.toDataURL(),a(t.smlm.manifest.thumbnail)}).catch(function(e){s(e)})})},switchChannel:function(e){console.log(e)},selectFile:function(e){this.append_mode=e,this.running_progress=0,this.$refs.select_file_input.click()},updateStatus:function(e){e.running&&(this.running=e.running),e.running_status&&(this.running_status=e.running_status),e.running_progress&&(this.running_progress=e.running_progress)},fileSelected:function(e){var t=this,a=e.target.files;if(console.log("file selected",a),a&&a.length>0)if(1==a.length?this.selected_file_name=a[0].name:this.selected_file_name=a[0].name+", "+a[1].name+" etc.",console.log(a),this.selected_file=a[0],this.selected_file_name.endsWith(".smlm")||"application/zip"==this.selected_file.type||"application/smlm"==this.selected_file.type)this.loadSmlm();else{var s=new FileReader,i=this.selected_file.slice(0,100);s.onload=function(e){t.file_sample_lines=e.target.result.split("\n").slice(0,2),t.file_sample_lines[0].includes("x [nm]")&&t.file_sample_lines[0].includes("\t")?t.text_file_format="ThunderSTORM (xls)":t.file_sample_lines[0].includes("x [nm]")&&t.file_sample_lines[0].includes(",")?t.text_file_format="ThunderSTORM (csv)":t.file_sample_lines[0].includes("Position X [nm]")&&t.file_sample_lines[0].includes("\t")?t.text_file_format="ZEISS (txt)":t.file_sample_lines[0].includes("Position X [nm]")&&t.file_sample_lines[0].includes(";")?t.text_file_format="ZEISSv1 (csv)":t.file_sample_lines[0].includes("x [nm]")&&t.file_sample_lines[0].includes(";")?t.text_file_format="ZEISSv2 (csv)":t.file_sample_lines[0].startsWith("#")&&t.file_sample_lines[0].includes("identifier=")?t.text_file_format="RapidSTORM (txt)":t.file_sample_lines[0].includes("x ")&&t.file_sample_lines[0].includes("y ")?t.text_file_format="Space Seperated List (txt)":t.file_sample_lines[0].includes("X\t")&&t.file_sample_lines[0].includes("\tY\t")&&t.file_sample_lines[0].includes("Channel Name")?t.text_file_format="Nikon NSTORM (txt)":t.selected_file_name.endsWith(".png")?t.text_file_format="png":t.selected_file_name.endsWith(".jpg")?t.text_file_format="jpg":t.selected_file_name.endsWith(".jpeg")?t.text_file_format="jpeg":console.log("file format is not recognized",t.selected_file.name),t.selected_file_name.endsWith(".png")||t.selected_file_name.endsWith(".jpg")||t.selected_file_name.endsWith(".jpeg")?t.tags=["#WF"]:t.tags=["#SR"],t.append_mode=!1,t.showImportDialog=!0},s.onerror=function(){t.show("can't read file",5e3)},s.readAsText(i)}},stopAnetProcess:function(){var e=this;this.anet_taskid&&this.store.session.call("org.imod.user.tasks.update_task",[this.anet_taskid,{closed:!0}],{},{disclose_me:!0}).then(function(t){e.api.show("task stopped.")}).catch(function(t){console.error(t),e.api.show(t.args[0])}),this.use_widefield=!1,this.anet_running=!1,this.showProcessDialog=!1,this.anet_output_sample_hash=null,this.anet_output_available=!1,this.show_anet_output=!1},sendForTraining:function(e){var t=this;this.anet_running=!0,this.uploadSample(e).then(function(){t.getSharedURL(t.smlm.manifest.hash,!1).then(function(e){var a={};N()(a,{name:"training_task_"+t.smlm.manifest.name,type:"train",inputs:[e],config:{input_file_hash:t.smlm.manifest.hash,input_file_name:t.smlm.manifest.name},tags:["@140"]}),t.store.session.call("org.imod.user.tasks.add_task",[a],{},{disclose_me:!0}).then(function(e){console.log("send data for training, task id:",e,a),t.api.show("Data sent for training",5e3),t.anet_running=!1}).catch(function(e){console.error(e),t.api.show("failed to notify the worker",5e3),t.anet_running=!1})}).catch(function(e){console.error(e),t.api.show("failed to share the file with the worker",5e3),t.anet_running=!1})}).catch(function(e){console.error(e),t.api.show("failed to send file",5e3),t.anet_running=!1})},runAnetProcess:function(){var e=this;if(this.anet_running=!0,console.log(this.selected_worker,this.tags),this.worker_validation_msg=null,!this.selected_worker)return this.api.show("Please select a worker.",5e3),this.worker_validation_msg="Please select a worker.",void(this.anet_running=!1);if(this.selected_worker.tags&&this.tags)for(var t=0;t<this.selected_worker.tags.length;t++){var a=this.selected_worker.tags[t];if(console.log(this.tags.indexOf(a)<0,a),this.tags.indexOf(a)<0)return this.worker_validation_msg="This worker can only work with samples tagged with '"+this.selected_worker.tags.join(",")+"'",this.api.show("You must tag your sample with at least: "+a,5e3),void(this.anet_running=!1)}var s=function(e){if("string"!=typeof e)throw new Error("Invalid argument: dataURI must be a string");for(var t=(e=e.split(","))[0].split(":")[1].split(";")[0],a=atob(e[1]),s=a.length,i=new ArrayBuffer(s),n=new Uint8Array(i),o=0;o<s;o++)n[o]=a.charCodeAt(o);return new Blob([n],{type:t})}(this.histogram_image);this.smlm.manifest.tags=this.smlm.manifest.tags||[];var i=SparkMD5.hash(this.smlm.manifest.hash+this.selected_smlm_file_hash+this.filter_expression+"pixel_size:"+this.pixel_size),n=SparkMD5.hash(i+"anet_output");this.anet_output_sample_hash=n,this.selected_smlm_file.tags=this.selected_smlm_file.tags||[];var r=this.selected_smlm_file.tags.slice();r.push("#input"),this.smlm.manifest.tags=this.smlm.manifest.tags||[];var l=this.smlm.manifest.tags.slice();l.push("#output");var d=function(t,a,s){a=a||null,s=s||null,e.anet_running=!0,e.store.session.call("org.imod.user.samples.get_shared_link",[e.anet_output_sample_hash,!1],{},{disclose_me:!0}).then(function(i){if(console.log(i),!i.public_uuid&&!i.shared_token)return e.api.show("Failed to get a shared link",5e3),void(e.anet_running=!1);e.store.session.call("org.imod.user.files.get_upload_url",[{name:"anet_output",type:"image/png",tags:["#output"],sample_hash:e.anet_output_sample_hash,hash:n},!0],{},{disclose_me:!0}).then(function(r){console.log("get upload url for output file",r);var l={};e.selected_worker.task_template&&N()(l,e.selected_worker.task_template),N()(l,{name:"task_"+t,type:"test",inputs:[i],config:{input_file:a,input_sr_file:a,input_pixel_size:e.pixel_size,output_file:r,input_wf_file:s,wf_pixel_size:e.pixel_size},tags:["@"+e.selected_worker_uri],expiresIn:120}),e.store.session.call("org.imod.user.tasks.add_task",[l],{},{disclose_me:!0}).then(function(t){e.anet_taskid=t;e.store.session.subscribe("org.imod.user.task."+t.$oid,function(a){var s=a[0];console.log(s),s.closed&&(s.error?e.api.show(s.error,5e3):(console.log("data uploaded, finishing",s.outputs.output_file),e.store.session.call("org.imod.user.files.finish_upload",[r.key,s.outputs.output_file],{},{disclose_me:!0}).then(function(t){console.log("finished output data upload"),e.api.show("process done",4e3),e.store.session.call("org.imod.public.get_shared_sample",[i],{},{disclose_me:!0}).then(function(t){console.log("output sample loaded",t),e.store.session.call("org.imod.public.get_shared_sample_file",[i,n],{},{disclose_me:!0}).then(function(t){console.log("output file url",t.url),o.a.get(t.url,{responseType:"blob"}).then(function(t){console.log(t);var a=t.data,s=new FileReader;s.onload=function(t){var a=new Image;a.addEventListener("load",function(){e.anet_output_img=a,e.show_anet_output=!0,e.anet_output_available=!0,e.anet_render2d_config.brightness=0,e.updateCanvas(),e.support140||(e.show140=!0)}),a.src=t.target.result},s.readAsDataURL(a),e.showProcessDialog=!1,e.anet_running=!1}).catch(function(t){console.error(t),e.api.show(t),e.anet_running=!1})}).catch(function(t){console.error(t),e.api.show(t.args[0]),e.anet_running=!1})}).catch(function(t){console.error(t),e.error_content="Sample was not found.",e.api.show(t.args[0],5e3),e.anet_running=!1})}).catch(function(t){console.error(t),e.api.show("upload failed, please try again.",5e3),e.anet_running=!1})),console.log("task closed: ",updates),e.anet_running=!1,e.showProcessDialog=!1,e.store.session.unsubscribe("org.imod.user.task."+t.$oid)),console.log("task updated: ",updates)}),console.log("task added.")}).catch(function(t){console.error(t),e.api.show(t.args[0]),e.anet_running=!1})}).catch(function(t){console.error(t),e.api.show("Failed to get a upload link",5e3),e.anet_running=!1})}).catch(function(t){console.error(t),e.api.show("Failed to get a shared link",5e3),e.anet_running=!1})};this.generateThumbnail().then(function(){console.log("update thumbnail for sample");var t={name:"rendering_"+e.smlm.manifest.name+".png",size:s.size,type:s.type,sample_hash:e.anet_output_sample_hash,sample_config:{hash:e.anet_output_sample_hash,description:e.smlm.manifest.description,tags:l,uid:e.store.uid,thumbnail:e.smlm.manifest.thumbnail,license:e.smlm.manifest.license,citeAs:e.smlm.manifest.citeAs},hash:i,tags:r,metadata:{filter_expression:e.filter_expression}};console.log(t),"image"!=e.current_displaying?e.getUploadUrl(t).then(function(a){var n=a.url,o=a.key;if((!n||null===n)&&o)return console.log("file already uploaded, add task."),void(e.use_widefield?e.uploadWidefieldImage(e.anet_output_sample_hash).then(function(t){d(o,i,e.widefield_available.hash)}).catch(function(t){console.log(t),e.api.show(t)}):d(o,i));e.uploadFile(s,t,o,n).then(function(){e.use_widefield?e.uploadWidefieldImage(e.anet_output_sample_hash).then(function(t){d(o,i,e.widefield_available.hash)}).catch(function(t){console.log(t),e.api.show(t)}):d(o,i)}).catch(function(t){console.log(t),e.api.show(t),e.anet_running=!1})}).catch(function(t){console.log(t),e.api.show(t),e.anet_running=!1}):e.use_widefield?e.uploadWidefieldImage(e.anet_output_sample_hash,t.sample_config).then(function(t){d(t,null,e.widefield_available.hash)}).catch(function(t){console.log(t),e.api.show(t),e.anet_running=!1}):(e.api.show("You are displaying an image, please switch on use widefield."),e.anet_running=!1)}).catch(function(t){console.error(t),e.api.show("something went wrong."),e.anet_running=!1})},uploadWidefieldImage:function(e,t){var a=this;return new M.a(function(s,i){if(a.widefield_available&&"image"==a.widefield_available.type){var n=a.widefield_available.data.file;console.log(a.widefield_available);var o=a.widefield_available,r={name:o.name,type:"image/png",tags:o.tags,hash:a.widefield_available.hash,sample_hash:e,sample_config:t};a.getUploadUrl(r).then(function(e){var t=e.url,i=e.key;t&&null!==t||!i?a.uploadFile(n,r,i,t).then(function(e){console.log("widefield uploaded"),s(e)}):(console.log("widefield already uploaded"),s(i))}).catch(function(e){console.log(e),a.api.show(e),i(e)})}else i()})},showAnetProcess:function(){var e=this;if(!this.store.signed_in||!this.store.session)return this.api.showLogin(),void this.api.show("please login or signup with your email.");this.worker_validation_msg=null,this.anet_output_sample_hash=null,this.anet_output_available=!1,this.show_anet_output=!1,this.showProcessDialog=!0,this.loading_worker_list=!0,this.support140=!0;for(var t=null,a=0;a<this.smlm.files.length;a++)if(this.smlm.files[a].tags&&this.smlm.files[a].tags.indexOf("#WF")>=0){t=this.smlm.files[a];break}t&&"image"==t.type?(this.widefield_available=t,this.use_widefield=!0):(this.widefield_available=null,this.use_widefield=!1),this.store.session.call("org.imod.public.get_worker_stats",[],{},{disclose_me:!0}).then(function(t){e.api.show("worker list updated."),e.worker_list=t,e.loading_worker_list=!1}).catch(function(t){console.log(t),e.api.show(t),e.loading_worker_list=!1})},loadFile:function(){"SMLM format"==this.text_file_format?this.loadSmlm():this.selected_file_name.endsWith(".png")?this.loadImageFile("png"):this.selected_file_name.endsWith(".jpg")?this.loadImageFile("jpg"):this.selected_file_name.endsWith(".jpeg")?this.loadImageFile("jpg"):this.loadTextFile(this.text_file_format)},loadImageFile:function(e){var t=this;console.time("load image file");var a=this.append_mode&&this.smlm?this.smlm:new ae,s={offset:{x:this.offset_x,y:this.offset_y},tags:this.tags,channel:this.channel_name,pixel_size:this.pixel_size};this.options=this.options||{},a.import_image(this.selected_file,e,s,this.append_mode,this.updateStatus).then(function(e){t.file_tags=e.tags,t.running=!1;var s=e.metadata;t.metadata=s,console.timeEnd("load image file"),t.rendering_status="image loaded",t.rendering_progress=100,t.rendering=!1,t.rendered=!0,t.api.show("image loaded.",3e3),t.smlm=a,t.loadSmlmFile(e),t.selected_filter=null,t.tags=t.smlm.manifest.tags.slice(),t.filter_enabled=!1}).catch(function(e){t.running=!1,console.log(e),t.api.show(e,5e3)})},plotImage:function(e){this.histogram_width=e.width,this.histogram_height=e.height;var t=document.createElement("canvas"),a=t.getContext("2d");t.width=e.width,t.height=e.height,a.drawImage(e,0,0),this.histogram_image=t.toDataURL("image/png"),console.log("tags:",this.tags),this.tags.indexOf("#SR")>=0?this.current_displaying="hist":this.current_displaying="image";var s=a.getImageData(0,0,t.width,t.height);this.render_canvas(s)},loadTextFile:function(e){var t=this;console.time("load text file",e);var a=this.append_mode&&this.smlm?this.smlm:new ae,s={offset:{x:this.offset_x,y:this.offset_y},tags:this.tags,channel:this.channel_name,pixel_size:this.pixel_size};a.import_text_table(this.selected_file,e,s,this.append_mode,this.updateStatus).then(function(e){t.file_tags=e.tags,t.running=!1,console.timeEnd("load text file"),console.log(e);var s=e.metadata;t.metadata=s,t.api.show("file loaded.",3e3),t.smlm=a,t.loadSmlmFile(e),t.tags=t.smlm.manifest.tags.slice(),t.filter_enabled=!0}).catch(function(e){t.running=!1,console.log(e),t.api.show(e,5e3)})},loadSmlm:function(){var e=this;console.time("load smlm file");var t=new ae;this.append_mode=!1,t.import_smlm(this.selected_file,this.append_mode,this.updateStatus).then(function(a){e.running=!1,console.timeEnd("load zip file"),e.api.show("file loaded.",3e3),e.smlm=t,e.tags=e.smlm.manifest.tags.slice();var s=a[0];e.metadata=s.metadata,e.loadSmlmFile(s),e.filter_enabled=!0}).catch(function(t){e.running=!1,console.log(t),e.api.show(t,5e3),e.running_status=t})},getSharedURL:function(e,t){var a=this;return new M.a(function(s,i){var n=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");a.store.session.call("org.imod.user.samples.get_shared_link",[e,a.make_public],{},{disclose_me:!0}).then(function(e){if(console.log(e),e.msg&&a.api.show(e.msg,5e3),a.make_public&&!e.public_uuid&&alert("This sample was uploaded by someone else before, you cannot make it public, but you can contact the administrator to override this."),!t)return e.public_uuid||e.hash&&e.shared_token?void s(e):void i(e);if(e.public_uuid){var o=n+"/#/view?u="+e.public_uuid;console.log(o,e),a.$router.push({path:"/view",query:{u:e.public_uuid}}),s(o)}else if(e.hash&&e.shared_token){console.log("shared link:",n+"/#/view?sample="+e.hash+"&token="+e.shared_token);var r=n+"/#/view?sample="+e.hash+"&token="+e.shared_token;console.log(r,e),a.$router.push({path:"/view",query:{sample:e.hash,token:e.shared_token}}),s(r)}else console.error("error",e),a.api.show("error occured when getting shared url.",5e3),i(e)})})},shareSample:function(e,t){var a=this;return new M.a(function(s,i){a.showUploading=!0,a.running_status="Preparing for sharing...",a.uploadSample(t).then(function(){a.showUploading=!1,(a.get_shared_link||e)&&a.getSharedURL(a.smlm.manifest.hash,!0).then(function(t){console.log(t),a.anet_output_available&&a.show_anet_output&&a.anet_output_sample_hash?a.getSharedURL(a.anet_output_sample_hash,!0).then(function(t){a.shared_link=t,a.showSharedLink=e,s()}).catch(function(e){console.error(e),a.api.show(e)}):(a.shared_link=t,a.showSharedLink=e,s())})}).catch(function(e){a.running_status="Something went wrong when sharing sample.",console.error(e),a.api.show("something went wrong when sharing sample.",5e3)})})},uploadSample:function(e){var t=this;return new M.a(function(a,s){if(t.smlm.uploaded)console.log("already uploaded"),a();else{t.renderWorker&&(t.renderWorker.terminate(),t.renderWorker=null),t.smlm.manifest.name.endsWith(".smlm")||(t.smlm.manifest.name=t.smlm.manifest.name+".smlm");var i={name:t.smlm.manifest.name,type:"application/smlm",sample_hash:t.smlm.manifest.hash,sample_config:{uid:t.store.uid,hash:t.smlm.manifest.hash,description:t.smlm.manifest.description,tags:t.smlm.manifest.tags,thumbnail:t.smlm.manifest.thumbnail,citeAs:t.smlm.manifest.citeAs,license:t.smlm.manifest.license},hash:t.smlm.manifest.hash,tags:["#smlm"],metadata:{}};if(console.log(i),t.smlm.manifest.format_version!=oe.format_version&&(e=!0,console.log("format version upgrade, overwriting...",t.smlm.manifest.format_version,"--\x3e",oe.format_version)),console.log(t.smlm.manifest.tags,t.tags),t.smlm.manifest.tags.length==t.tags.length){for(var n=0;n<t.smlm.manifest.tags.length;n++)if(-1==t.tags.indexOf(t.smlm.manifest.tags[n])){e=!0;break}}else e=!0;t.getUploadUrl(i,e).then(function(e){var n=e.url,o=e.key;if((!n||null===n)&&o)return console.log("file already uploaded"),void a();t.smlm.save(t.updateStatus).then(function(e){t.running=!1,t.uploadFile(e,i,o,n).then(function(e){t.api.show("uploaded"),a()}).catch(function(e){console.error(e),t.api.show(e),s(e)})}).catch(function(e){console.error(e),t.api.show(e),s(e)})}).catch(function(e){console.error(e),t.api.show(e),s(e)})}})},downloadSmlmFile:function(){var e=this;this.renderWorker&&(this.renderWorker.terminate(),this.renderWorker=null),this.smlm.save(this.updateStatus).then(function(t){e.running=!1;var a=t.name;t.name.endsWith(".smlm")||t.name.endsWith(".zip")||(a=t.name+".smlm"),Object(P.saveAs)(t,a)}).catch(function(t){e.api.show(t)})},getUploadUrl:function(e,t){var a=this;return new M.a(function(s,i){a.store.signed_in&&a.store.session||(a.api.showLogin(),a.api.show("please login or signup with your email."),i("please login or signup with your email.")),console.log(e),a.store.session.call("org.imod.user.files.get_upload_url",[e,t],{},{disclose_me:!0}).then(function(e){s(e)}).catch(function(e){console.log("error",e),e.args?a.api.show("error occured "+e.args[0],5e3):a.api.show("error occured "+e.toString(),5e3),i(e.args)})})},uploadFile:function(e,t,a,s){var i=this;return new M.a(function(n,r){var l=t.metadata||{},d={};for(var m in l)l[m].constructor===Array?d["x-amz-meta-"+m]=l[m].join():d["x-amz-meta-"+m]=l[m]?l[m].toString():"";var c={"Content-Type":e.type};N()(c,d);var u={headers:c,onUploadProgress:function(t){i.running_progress=Math.round(1*t.loaded/e.size*100),i.running_status="uploading your smlm file to our secured storage, size: "+Math.round(e.size/1e6)+"MB, "+i.running_progress+"% uploaded."}};i.running=!0,i.running_progress=0,i.running_status="uploading to our secured storage...",console.log("upload to ",s),o.a.put(s,e,u).then(function(t){i.running=!1,console.log("data uploaded, finishing"),i.store.session.call("org.imod.user.files.finish_upload",[a,{name:e.name,type:e.type,size:e.size}],{},{disclose_me:!0}).then(function(e){i.api.show("data uploaded.",4e3),console.log("finished data upload"),n(a)}).catch(function(e){console.error(e),i.api.show("upload failed, please try again.",5e3),r(e)})}).catch(function(e){console.error(e),i.api.show("upload failed, please check your s3 configuration.",5e3),i.running=!1,r(e)})})},updateFPS:function(e){this.fps=e.fps,this.ppf=e.ppf},switch3DView:function(e){this.$forceUpdate(),e?this.options.tableDict.z?(this.render3d_loaded||(Ee(document.getElementById("histogram_canvas_3d"),this.updateFPS),this.render3d_loaded=!0),this.plotHist()):(this.api.show("no data found on z dimension.",4e3),this.use_3d=!1):this.plotHist()},update_selected_filter:function(){this.filter_expression="";for(var e=0;e<this.options.headers.length;e++)isFinite(this.filter_ranges[this.options.headers[e]][0])&&isFinite(this.filter_ranges[this.options.headers[e]][1])&&this.filter_ranges[this.options.headers[e]][1]!=this.filter_ranges[this.options.headers[e]][0]&&(this.filter_ranges[this.options.headers[e]][0]!=this.options.min[this.options.headers[e]]&&(this.filter_expression+=this.options.headers[e]+">="+this.filter_ranges[this.options.headers[e]][0]+" and "),this.filter_ranges[this.options.headers[e]][1]!=this.options.max[this.options.headers[e]]&&(this.filter_expression+=this.options.headers[e]+"<="+this.filter_ranges[this.options.headers[e]][1]+" and "));" and "==this.filter_expression.slice(-5)&&(this.filter_expression=this.filter_expression.slice(0,-5)),console.log("generated filter expression:",this.filter_expression),this.plotHist()},reset_filters:function(){for(var e=0;e<this.options.headers.length;e++)this.filter_ranges[this.options.headers[e]]=[Math.round(this.options.min[this.options.headers[e]]),Math.round(this.options.max[this.options.headers[e]])];this.options.headers.indexOf("frame")>=0&&this.switch_selected_filter("frame"),this.filter_expression="",this.hist_render2d_config.brightness=100,this.plotHist()},switch_selected_filter:function(e){if(console.log(e),this.selected_filter=e,!this.filter_ranges[e])for(var t=0;t<this.options.headers.length;t++)this.filter_ranges[this.options.headers[t]]=[this.options.min[this.options.headers[t]],this.options.max[this.options.headers[t]]];this.selected_filter_range=this.filter_ranges[e],this.selected_filter_min=this.options.min[e],this.selected_filter_max=this.options.max[e],console.log(this.filter_ranges)},updateRenderStatus:function(e){this.rendering_progress=e.rendering_progress||this.rendering_progress,this.rendering_status=e.rendering_status||this.rendering_status,this.rendering=e.rendering||this.rendering},plotHist:function(e){var t=this;return this.show_anet_output=!1,this.current_render2d_config=this.hist_render2d_config,e=e||this.options,console.log(e),!e.tableDict||e.headers.length<=0||e.tableArrays.length<=0?(console.log({canvas_img_data:canvas_img_data,options:e}),console.log("rendering error."),void this.api.show("something went wrong, data is not loaded.",5e3)):new M.a(function(a,s){t.rendering_progress=0,t.rendering_status="rendering",t.rendering=!0;var i=t.pixel_size||20;e.pixel_size=i,t.pixel_size=i;for(var n=[],o=0;o<e.headers.length;o++)n[o]=e.headers[o];t.filter_tooltip="you can use these variables in your filter: "+n.join(", ")+" , use random() to do random sampling.",console.log("max_frame_number",e.max.frame,"min_frame_number",e.min.frame),t.filter_ranges.x=t.filter_ranges.x||[e.min.x,e.max.x],t.filter_ranges.y=t.filter_ranges.y||[e.min.y,e.max.y],e.xy_range=[],e.xy_range[0]=Math.round(t.filter_ranges.x[0]/i),e.xy_range[1]=Math.round(t.filter_ranges.x[1]/i),e.xy_range[2]=Math.round(t.filter_ranges.y[0]/i),e.xy_range[3]=Math.round(t.filter_ranges.y[1]/i),t.histogram_width=Math.min(e.xy_range[1]-e.xy_range[0],2560),t.histogram_height=Math.min(e.xy_range[3]-e.xy_range[2],2560),e.histogram_width=t.histogram_width,e.histogram_height=t.histogram_height,e.filter_expression=t.filter_expression,e.offset_mode=t.offset_mode,console.log("filtering...",t.offset_mode);var r={file_name:e.file_name,file_size:e.file_size,file_id:e.file_id,tableDict:e.tableDict,rows:e.rows,xy_range:e.xy_range,offset_mode:t.offset_mode,histogram_width:e.histogram_width,histogram_height:e.histogram_height,pixel_size:e.pixel_size,filter_expression:e.filter_expression,min:e.min,max:e.max},l=t.filterWorker;if(!l){if("undefined"==typeof Worker)return console.log("Web Worker not available"),void t.api.show("Web Worker not available");l=new Worker("static/js/AsyncFilter.js"),t.filterWorker=l}l.onerror=function(e){console.log("filterWorker went wrong: ",e)},l.onmessage=function(s){if(s.data.progress&&(t.rendering=!0,t.rendering_progress=Math.round(s.data.progress)),s.data._options){if(s.data._options.tableDict&&e.tableDict)for(var i in s.data._options.tableDict)e.tableDict[i]=s.data._options.tableDict[i];s.data._options.isFiltered&&(e.isFiltered=s.data._options.isFiltered)}s.data.finished&&(console.log("finished filtering"),r.isFiltered=s.data.isFiltered,r.filteredRows=s.data.filteredRows,r.frameNumber=s.data.frameNumber,t.localizationNumber=r.filteredRows,t.frameNumber=r.frameNumber,console.log(r),t.use_3d?t.render3d(r).then(function(){a()}):t.render2d(r).then(function(){a()}),t.current_displaying="hist")},t.rendering_status="filtering...";var d=[];for(var m in r.tableDict)d.push(r.tableDict[m].buffer);l.postMessage({options:r},d)})},render2d:function(e){var t=this;return new M.a(function(a,s){var i=t.renderWorker;if(!i){if("undefined"==typeof Worker)return console.log("Web Worker not available"),void t.api.show("Web Worker not available");i=new Worker("static/js/AsyncRenderer.js"),t.renderWorker=i}var n=document.createElement("canvas");n.width=t.histogram_width,n.height=t.histogram_height;var o=n.getContext("2d"),r=o.getImageData(0,0,n.width,n.height);i.onerror=function(e){console.log("renderWorker went wrong: ",e),t.rendered=!0,t.rendering=!1,t.rendering_status="error ocurred: "+e.data.message,t.api.show(e.data.message,5e3),e.data.message.includes("fillter expression")&&(t.show_filter=!0),t.renderWorker=null,i.terminate(),s()},i.onmessage=function(r){if(r.data.progress&&(t.rendering=!0,t.rendering_progress=Math.round(r.data.progress)),r.data._options){if(r.data._options.tableDict&&e.tableDict)for(var l in r.data._options.tableDict)e.tableDict[l]=r.data._options.tableDict[l];r.data._options.isFiltered&&(e.isFiltered=r.data._options.isFiltered)}r.data.finished?(console.log("finished rendering"),t.screenWidth>800?(t.rendering_status=e.filteredRows+", file:"+t.options.file_name+").",t.histogram_width<e.xy_range[1]-e.xy_range[0]||t.histogram_height<e.xy_range[3]-e.xy_range[2]?t.rendering_status="histogram rendered (truncated to "+t.histogram_width+"x"+t.histogram_height+", loc.:"+t.rendering_status:t.rendering_status="histogram rendered (loc.:"+t.rendering_status):t.rendering_status="rendered ",t.rendering_progress=100,o.putImageData(r.data.canvas_img_data,0,0),t.rendering=!1,t.rendered=!0,t.histogram_image=n.toDataURL("image/png"),t.render_canvas(r.data.canvas_img_data,100),a(t.histogram_image)):r.data.error&&(console.log("error during rendering "),t.rendered=!0,t.rendering=!1,t.rendering_status="error ocurred: "+r.data.message,t.api.show(r.data.message,5e3),r.data.message.includes("fillter expression")&&(t.show_filter=!0),t.renderWorker=null,i.terminate(),s())},t.rendering_status="rendering...",console.log("rendering in canvas");var l=[];for(var d in e.tableDict)l.push(e.tableDict[d].buffer);e.isFiltered&&l.push(e.isFiltered.buffer),i.postMessage({canvas_img_data:r,options:e},l)})},render3d:function(e){var t=this;return new M.a(function(a,s){try{Ke(e,t.updateRenderStatus)}catch(e){s("3d rendering error"),console.error(e),t.rendering_status="something went wrong during rendering."}finally{t.rendering=!1,t.rendered=!0,a()}})},render_canvas:function(e,t){var a=this;this.rendered=!0;var s=void 0;t=t||1,this.leafletMap?s=this.leafletMap:(s=L.map("leaflet_histogram",{minZoom:1,maxZoom:4,center:[0,0],zoom:1,crs:L.CRS.Simple}),this.leafletMap=s);var i=function(e){a._canvas_data=e;var i=a.histogram_width,n=a.histogram_height,o=function(e){u.filterImage(e,u.brightness,0,t),a.use_lut&&u.filterImage(e,u.lut,_);var s=document.createElement("canvas");return s.width=a.histogram_width,s.height=a.histogram_height,s.getContext("2d").putImageData(e,0,0),s.toDataURL("image/png")}(e);a.export_histogram_png=o.replace("image/png","application/octet-stream"),a.screenWidth<=800?s.options.minZoom=-2:s.options.minZoom=-1;var r=s.unproject([0,n],s.options.zoom),l=s.unproject([i,0],s.options.zoom),d=new L.LatLngBounds(r,l);a._canvas_layer&&s.removeLayer(a._canvas_layer),a._canvas_layer=L.imageOverlay(o,d),a._canvas_layer.addTo(s),s.setMaxBounds(d),setTimeout(function(){a.leafletMap.invalidateSize(),a.$forceUpdate()},800)};if(e)i(e);else{var n=new Image;n.onload=function(){var t=document.createElement("canvas");t.width=n.width,t.height=n.height;var s=t.getContext("2d");s.drawImage(n,0,0),e=s.getImageData(0,0,t.width,t.height),i(e),a.$refs["brightness-slider"]&&a.$refs["brightness-slider"].refresh()},n.onerror=function(){a.rendering=!1,a.rendered=!0},n.src=this.histogram_image}},render_canvas2:function(e,t){var a=this;this.rendering_status="almost done, showing on the canvas...",t=t||0,console.log("adjust brightness",t);var s=this.histogram_image,i=document.getElementById("histogram_canvas"),n=i.getContext("2d"),o=new Image;this.use_lut;o.onload=function(){n.drawImage(o,0,0);var s=i.height,r=i.width;if(e=e||n.getImageData(0,0,r,s),!t){var l=u.min_max(e);t=0==l.max?1:255/l.max,a.current_render2d_config.brightness=parseInt(t)}u.filterImage(e,u.brightness,0,t),a.use_lut&&u.filterImage(e,u.lut,_),n.putImageData(e,0,0);var d=document.getElementById("histogram_canvas").toDataURL("image/png").replace("image/png","application/octet-stream");a.export_histogram_png=d,console.log("prepared url for image download"),a.rendering_progress=100,a.rendering_status="ready.",a.rendering=!1,a.rendered=!0,a.$refs["brightness-slider"]&&a.$refs["brightness-slider"].refresh()},o.onerror=function(){a.rendering=!1,a.rendered=!0},o.src=s},download_image:function(e,t){for(var a=atob(e.split(",")[1]),s=new ArrayBuffer(a.length),i=new Uint8Array(s),n=0;n<a.length;n++)i[n]=255&a.charCodeAt(n);try{var o=new Blob([s],{type:"application/octet-stream"})}catch(e){var r=new(window.WebKitBlobBuilder||window.MozBlobBuilder);r.append(s);o=r.getBlob("application/octet-stream")}var l=document.createElement("a");document.body.appendChild(l),l.style="display: none";var d=(window.webkitURL||window.URL).createObjectURL(o);l.href=d,l.download=t,l.click(),window.URL.revokeObjectURL(d)}}},at={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"viewer"},[a("div",{staticClass:"md-title"},[e._v(e._s(e.title))]),e._v(" "),a("md-app",{directives:[{name:"show",rawName:"v-show",value:e.options,expression:"options"}]},[!e.menuVisible||e.options&&e.options.tableDict&&e.show_filter||null!==e.selected_filter&&null!==e.selected_filter_max&&null!==e.selected_filter_min?a("md-app-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[!e.menuVisible&&e.options?a("md-button",{staticClass:"md-fab md-primary",on:{click:function(t){e.menuVisible=!0}}},[a("md-icon",[e._v("menu")])],1):e._e(),e._v(" "),e.options?a("div",{staticClass:"md-layout md-xsmall-hide"},[a("md-switch",{directives:[{name:"show",rawName:"v-show",value:e.rendered&&e.options&&e.options.tableDict&&e.options.tableDict.z,expression:"rendered && options && options.tableDict && options.tableDict.z"}],attrs:{disabled:!e.options||!e.options.tableDict||!e.options.tableDict.z&&!e.use_3d,name:"use LUT"},on:{change:function(t){e.switch3DView(e.use_3d)}},model:{value:e.use_3d,callback:function(t){e.use_3d=t},expression:"use_3d"}},[e._v("3D View")]),e._v("Â Â \n               ")],1):e._e(),e._v(" "),e.filter_enabled&&e.rendered&&null!==e.selected_filter&&null!==e.selected_filter_max&&null!==e.selected_filter_min?a("div",{staticClass:"md-toolbar-section-start slider-toolbar"},[a("div",{staticClass:"md-layout-item",attrs:{flex:""}},[a("span",{staticClass:"md-xsmall-hide"},[e._v("Set range for")]),e._v(" "),a("md-chip",[e._v(e._s(e.selected_filter))]),e._v(" "+e._s((e.filter_ranges[e.selected_filter][1]-e.filter_ranges[e.selected_filter][0]).toFixed(1))+", "+e._s(e.filter_ranges[e.selected_filter])+"\n                   "),a("div",[a("vue-slider",{ref:"filter-slider",attrs:{disabled:e.rendering,"tooltip-dir":"bottom",max:e.selected_filter_max,min:e.selected_filter_min},on:{"drag-end":function(t){e.update_selected_filter()}},model:{value:e.filter_ranges[e.selected_filter],callback:function(t){e.$set(e.filter_ranges,e.selected_filter,t)},expression:"filter_ranges[selected_filter]"}}),e._v(" "),a("md-tooltip",[e._v(' Adjust filter range for "'+e._s(this.selected_filter)+'"')])],1)],1)]):e._e(),e._v(" "),e.options&&e.options.tableDict&&e.show_filter?a("div",{staticClass:"md-toolbar-section-start",attrs:{flex:""}},[a("md-button",{directives:[{name:"show",rawName:"v-show",value:e.rendered&&e.show_filter,expression:"rendered && show_filter"}],staticClass:"md-accent md-icon-button",attrs:{disabled:e.rendering},on:{click:function(t){e.plotHist()}}},[a("md-icon",[e._v("refresh")]),e._v(" "),a("md-tooltip",[e._v(" Refresh ")])],1),e._v(" "),a("md-field",[a("label",{staticClass:"md-xsmall-hide",attrs:{for:"filter-id"}},[e._v("Filter Expression (e.g. frame>1000 and random()<0.1)")]),e._v(" "),a("md-input",{attrs:{disabled:e.rendering,type:"text"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.plotHist()}},model:{value:e.filter_expression,callback:function(t){e.filter_expression=t},expression:"filter_expression"}}),e._v(" "),a("span",{staticClass:"md-helper-text md-xsmall-hide"},[e._v(e._s(e.filter_tooltip))]),e._v(" "),a("md-tooltip",[e._v(e._s(e.filter_tooltip))])],1)],1):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.running&&!e.menuVisible&&e.options&&e.screenWidth>800,expression:"running && !menuVisible && options && screenWidth>800"}],staticClass:"md-toolbar-section-end md-xsmall-hide",attrs:{layout:"row"}},[a("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait, this may take a while.":"")+" ")]),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}})],1)],1)]):e._e(),e._v(" "),a("md-app-drawer",{attrs:{"md-active":e.menuVisible,"md-persistent":"full"},on:{"update:mdActive":function(t){e.menuVisible=t}}},[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.running,expression:"!running"}],staticClass:"md-toolbar-row",attrs:{flex:""}},[e._t("actions",[a("md-button",{staticClass:"md-fab md-primary",on:{click:function(t){e.selectFile(!0)}}},[a("md-icon",[e._v("add")]),e._v(" "),a("md-tooltip",[e._v("Load another file")])],1),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:e.shareFile}},[a("md-icon",[e._v("share")]),e._v("Share\n                     "),a("md-tooltip",[e._v("share this smlm file")])],1),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-icon-button md-dense md-raised",on:{click:function(t){e.menuVisible=!e.menuVisible}}},[a("md-icon",[e._v("keyboard_arrow_left")])],1)],1)],{download:e.downloadSmlmFile})],2),e._v(" "),e.running?a("div",{attrs:{layout:"row"}},[a("md-divider"),e._v(" "),a("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait, this may take a while.":"")+" ")]),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),a("br")],1):e._e(),e._v(" "),e.smlm?a("div",[a("span",{staticClass:"md-list-item-text"},[e._v("Files")]),e._v(" "),a("md-divider"),e._v(" "),e.loaded_sample&&e.smlm?a("md-list",e._l(e.loaded_sample.files,function(t,s){return a("md-list-item",{key:s,attrs:{"md-expand":e.smlm&&e.smlm.manifest.hash==s,"md-expanded":t.expandFiles},on:{click:function(a){e.showFilesDialog=!1,e.loadS3File(t,s)},"update:mdExpanded":function(a){e.$set(t,"expandFiles",a)}}},[e._v("\n                     "+e._s(e.smlm.manifest.hash==s?"+":"")+" "),e._l(t.tags,function(t){return a("md-chip",{key:t},[e._v(e._s(t))])}),e._v(" "),a("span",{class:e.selected_s3_file==s?"files-item-1-selected":"files-item-1"},[e._v(e._s(t.name))]),e._v(" "),e.smlm&&e.smlm.manifest.hash==s?a("md-list",{attrs:{slot:"md-expand"},slot:"md-expand"},e._l(e.smlm.files,function(t,s){return a("md-list-item",{key:t.hash,on:{click:function(a){e.showFilesDialog=!1,e.loadSmlmFile(t)}}},[a("span",{class:e.selected_smlm_file_hash==t.hash?"files-item-2-selected":"files-item-2"},[e._v("Â Â -Â \n                             "),e._l(t.tags,function(t,s){return s<3?a("md-chip",{key:t},[e._v(e._s(t))]):e._e()}),e._v(e._s(t.name)+"\n                           ")],2)])})):e._e()],2)})):e._e(),e._v(" "),!e.loaded_sample&&e.smlm&&e.smlm.files?a("md-list",e._l(e.smlm.files,function(t,s){return a("md-list-item",{key:t.hash,on:{click:function(a){e.showFilesDialog=!1,e.loadSmlmFile(t)}}},[a("span",{class:e.selected_smlm_file_hash==t.hash?"files-item-2-selected":"files-item-2"},[e._v("Â -Â \n                     "),e._l(t.tags,function(t,s){return s<3?a("md-chip",{key:t},[e._v(e._s(t))]):e._e()}),e._v(e._s(t.name)+"\n                   ")],2)])})):e._e()],1):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"md-layout",attrs:{"md-vertical-align":"end"}},[a("input",{ref:"select_file_input",staticClass:"md-file",attrs:{type:"file"},on:{change:e.fileSelected}})]),e._v(" "),e.filter_enabled?a("div",[a("span",{staticClass:"md-list-item-text"},[e._v("Apply filter")]),e._v(" "),a("md-divider"),e._v(" "),a("p",[e._v("click a name to set the value range:")]),e._v(" "),e.options&&e.options.headers?a("div",e._l(e.options.headers,function(t,s){return a("md-chip",{directives:[{name:"show",rawName:"v-show",value:e.options&&e.options.headers,expression:"options&&options.headers"}],key:s,class:e.selected_filter==t?"md-primary":"",attrs:{"md-clickable":""},on:{click:function(a){e.show_filter=!1,e.switch_selected_filter(t)}}},[e._v(e._s(t)+"\n                   "),a("md-tooltip",[e._v("click to set the range of '"+e._s(t)+"'")])],1)})):e._e(),e._v(" "),a("md-button",{attrs:{disabled:e.rendering},on:{click:function(t){e.reset_filters()}}},[a("md-icon",[e._v("settings_backup_restore")]),e._v("reset filter\n                 "),a("md-tooltip",[e._v(" Reset filter ")])],1),e._v(" "),a("md-button",{directives:[{name:"show",rawName:"v-show",value:e.rendered,expression:"rendered"}],on:{click:function(t){e.show_filter=!e.show_filter,e.selected_filter=null}}},[a("md-icon",[e._v("details")]),e._v("filter expression\n                 "),a("md-tooltip",[e._v(" Show filter expression")])],1),e._v(" "),a("br"),e._v(" "),a("br")],1):e._e(),e._v(" "),a("span",{staticClass:"md-list-item-text"},[e._v("Adjust brightness")]),e._v(" "),a("md-divider"),e._v(" "),a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("div",{staticClass:"md-layout-item"},[a("div",[a("vue-slider",{ref:"brightness-slider",attrs:{disabled:e.rendering,"tooltip-dir":"bottom",max:255,min:1},on:{"drag-end":function(t){e.updateCanvas()}},model:{value:e.current_render2d_config.brightness,callback:function(t){e.$set(e.current_render2d_config,"brightness",t)},expression:"current_render2d_config.brightness"}}),e._v(" "),a("md-tooltip",[e._v(" Adjust brightness ")])],1),e._v(" "),a("br")])]),e._v(" "),a("span",{staticClass:"md-list-item-text"},[e._v("More options")]),e._v(" "),a("md-divider"),e._v(" "),a("md-list",{attrs:{slot:"md-expand"},slot:"md-expand"},[a("md-list-item",{staticClass:"md-primary menu-button"},[a("md-switch",{attrs:{name:"use LUT"},on:{change:function(t){e.updateCanvas()}},model:{value:e.use_lut,callback:function(t){e.use_lut=t},expression:"use_lut"}},[a("span",{staticClass:"md-list-item-text"},[e._v("Apply LUT")])])],1),e._v(" "),a("md-list-item",[a("md-field",[a("label",{attrs:{for:"pixel_size"}},[e._v("Pixel Size (nm)")]),e._v(" "),a("md-input",{attrs:{type:"text",name:"pixel_size"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.plotHist()}},model:{value:e.pixel_size,callback:function(t){e.pixel_size=t},expression:"pixel_size"}})],1),e._v(" "),a("md-field",[a("label",{attrs:{for:"offset_mode"}},[e._v("Offset Mode")]),e._v(" "),a("md-select",{attrs:{name:"offset-mode"},on:{"md-closed":function(t){e.options&&e.options.tableDict&&e.plotHist()}},model:{value:e.offset_mode,callback:function(t){e.offset_mode=t},expression:"offset_mode"}},[a("md-option",{attrs:{value:"min-max"}},[e._v("min-max")]),e._v(" "),a("md-option",{attrs:{value:"zero-max"}},[e._v("zero-max")])],1)],1)],1),e._v(" "),e.tags?a("md-list-item",[a("md-chips",{attrs:{"md-limit":20,"md-placeholder":"Type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                        "+e._s(a)+"\n                        ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[a("div",{staticClass:"md-helper-text"},[e._v("please use tags to label this sample. E.g.: microtubule, hela, AF647")])])],1):e._e(),e._v(" "),a("md-list-item",{staticClass:"md-primary menu-button",on:{click:function(t){e.showInfoDialog=!0}}},[a("md-icon",[e._v("info")]),a("span",{staticClass:"md-list-item-text"},[e._v("Info")]),e._v(" "),a("md-tooltip",[e._v("show info")])],1),e._v(" "),a("md-list-item",{staticClass:"md-primary menu-button",on:{click:e.downloadSmlmFile}},[a("md-icon",[e._v("file_download")]),a("span",{staticClass:"md-list-item-text"},[e._v("Export")]),e._v(" "),e.smlm&&e.smlm.isSMLM?a("md-tooltip",[e._v("save as .smlm file")]):a("md-tooltip",[e._v("save as a compressed zip file")])],1),e._v(" "),a("md-list-item",{directives:[{name:"show",rawName:"v-show",value:e.export_histogram_png,expression:"export_histogram_png"}],staticClass:"md-primary menu-button",on:{click:function(t){e.download_image(e.export_histogram_png,"exported_input.png")}}},[a("md-icon",[e._v("save")]),a("span",{staticClass:"md-list-item-text"},[e._v("Save image")]),e._v(" "),a("md-tooltip",[e._v("download and save current image")])],1)],1)],1),e._v(" "),a("md-app-content",[(e.rendered||e.rendering)&&e.options&&e.options.tableDict?a("md-progress-bar",{attrs:{"md-value":e.rendering_progress}}):e._e(),e._v(" "),e.options?a("div",{staticClass:"canvas-container"},[(e.rendered||e.rendering)&&e.options&&e.options.tableDict?a("div",{staticClass:"md-layout render-info"},[a("span",[e._v(e._s(e.rendering_status)+" "+e._s(e.rendering_progress>0?e.rendering_progress+"%":"")+" ")]),a("span",{directives:[{name:"show",rawName:"v-show",value:e.use_3d,expression:"use_3d"}],staticClass:"render-info"},[e._v(" Â Â fps:"+e._s(e.fps)+", ppf:"+e._s(e.ppf)+" ")])]):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.rendered&&!e.use_3d,expression:"rendered && !use_3d"}],attrs:{id:"leaflet_histogram"}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.use_3d,expression:"use_3d"}],attrs:{id:"gui-webgl"}}),e._v(" "),a("canvas",{directives:[{name:"show",rawName:"v-show",value:e.use_3d,expression:"use_3d"}],attrs:{id:"histogram_canvas_3d"}})]):e._e(),e._v(" "),e.options||e.shared_url_mode?e._e():a("md-empty-state",{attrs:{flex:"","md-icon":"hourglass_empty","md-label":"Open a localization table","md-description":"Render your table in the browser, process and share it with our server."}},[e.running?a("div",[a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),a("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait...":"")+" ")])],1):e._e(),e._v(" "),a("md-button",{staticClass:"md-primary md-raised",attrs:{disabled:e.running},on:{click:function(t){e.selectFile(!1)}}},[a("md-icon",[e._v("add")]),e._v("Open a file\n                ")],1),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{id:"repository-button",disabled:e.running,to:"/repository"}},[e._v("\n                  No data? checkout the repository for public data.\n                ")]),e._v(" "),a("br"),e._v(" "),a("md-card",{staticClass:"faq-card"},[a("md-card-content",[a("h2",[e._v("FAQ")]),e._v(" "),a("h3",[e._v("What are the supported file formats?")]),e._v(" "),a("p",[e._v("Currently, you can load files with the following formats: "),a("a",{attrs:{href:"https://github.com/imodpasteur/smlm-file-format",target:"_blank"}},[e._v("SMLM(.smlm)")]),e._v(", ThunderSTORM(.csv/.xls), RapidSTROM, ZEISS(ELYRA), Nikon NSTORM(txt), .png, .jpg.")]),e._v(" "),a("p",[e._v(" If you have other file format which is not supported yet, please "),a("a",{attrs:{href:"https://www.dropbox.com/request/IyZ7HkzHUpB0t5Mkp46l",target:"_blank"}},[e._v("upload a sample file")]),e._v(", and "),a("a",{attrs:{href:"https://oeway.typeform.com/to/rdkPmd",target:"_blank"}},[e._v("send us a message")]),e._v(" to describe your file format, we will try to support your file format. ")]),e._v(" "),a("h3",[e._v("where does my data go?")]),e._v(" "),a("p",[e._v("Don't worry, your data will stay in your browser, and will not go to our server unless you use the sharing feature of ShareLoc.xyz.\n                    If you share data privately with our server, by default, no one else could access it, and we won't use it for other purposes without your permission.")]),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{to:"/faq"}},[e._v("read more")])],1)],1)],1),e._v(" "),!e.options&&e.shared_url_mode?a("md-empty-state",{attrs:{flex:"","md-icon":"hourglass_empty","md-label":"Loading sample...","md-description":"Please wait, this may take a while..."}},[e.running?a("div",[a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),a("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait...":"")+" ")])],1):e._e(),e._v(" "),e.loading_shared_url?a("div",[a("md-progress-spinner",{attrs:{"md-diameter":100,"md-stroke":10,"md-mode":"indeterminate"}})],1):e._e()]):e._e()],1)],1),e._v(" "),a("md-dialog-alert",{attrs:{"md-active":e.showErrorDialog,"md-content":e.error_content,"md-confirm-text":"OK","md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showErrorDialog=t}}}),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showUploading,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showUploading=t}}},[a("md-dialog-content",[a("div",{attrs:{layout:"row"}},[a("p",[e._v(e._s(e.running_status)+" "+e._s(e.running_status.length<30?", please wait, this may take a while.":"")+" ")]),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:!(e.running_progress&&e.running_progress>0),expression:"!(running_progress && running_progress>0)"}],attrs:{"md-mode":"indeterminate"}}),e._v(" "),a("md-progress-bar",{directives:[{name:"show",rawName:"v-show",value:e.running_progress&&e.running_progress>0,expression:"running_progress && running_progress>0"}],attrs:{"md-value":e.running_progress}}),e._v(" "),a("br")],1)]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showUploading=!1}}},[e._v("Close")])],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showImportDialog,"md-click-outside-to-close":!1},on:{"update:mdActive":function(t){e.showImportDialog=t}}},[a("md-dialog-content",[a("div",{staticClass:"md-layout-row md-gutter"},[a("div",{staticClass:"md-flex"},[e.selected_file?a("md-field",[a("label",{attrs:{for:"file-format"}},[e._v("File Format")]),e._v(" "),a("md-select",{attrs:{name:"file-format",id:"file-format"},model:{value:e.text_file_format,callback:function(t){e.text_file_format=t},expression:"text_file_format"}},e._l(e.supported_file_formats,function(t,s){return e.selected_file_name.endsWith(t.extension)||-1==e.selected_file_name.indexOf(".")?a("md-option",{key:s,attrs:{value:s}},[e._v(e._s(s))]):e._e()}))],1):e._e(),e._v(" "),a("md-field",[a("label",{attrs:{for:"pixel_size"}},[e._v("Pixel Size (nm)")]),e._v(" "),a("md-input",{attrs:{type:"text",name:"pixel_size"},model:{value:e.pixel_size,callback:function(t){e.pixel_size=t},expression:"pixel_size"}})],1),e._v(" "),a("div",{staticClass:"md-flex"},[a("label",[e._v("Tags for this channel/file")]),e._v(" "),a("md-chips",{attrs:{"md-limit":20,"md-placeholder":"Type a file tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                    "+e._s(a)+"\n                    ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[a("div",{staticClass:"md-helper-text"},[e._v("e.g. SR for SuperRes image, WF for widefield")])])],1),e._v(" "),this.smlm?a("md-switch",{attrs:{name:"append"},model:{value:e.append_mode,callback:function(t){e.append_mode=t},expression:"append_mode"}},[e._v("Append to the current file")]):e._e(),e._v(" "),a("md-switch",{attrs:{name:"more_options"},model:{value:e.show_more_import_options,callback:function(t){e.show_more_import_options=t},expression:"show_more_import_options"}},[e._v("more options")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.show_more_import_options,expression:"show_more_import_options"}]},[a("label",[e._v("File content:")]),e._v(" "),e._l(e.file_sample_lines,function(t,s){return a("p",{key:s},[e._v(" "+e._s(t)+" ")])}),e._v(" "),a("p",[e._v("...")]),e._v(" "),a("md-field",[a("label",{attrs:{for:"offset_mode"}},[e._v(" Offset Mode")]),e._v(" "),a("md-select",{attrs:{name:"offset-mode"},model:{value:e.offset_mode,callback:function(t){e.offset_mode=t},expression:"offset_mode"}},[a("md-option",{attrs:{value:"min-max"}},[e._v("min-max")]),e._v(" "),a("md-option",{attrs:{value:"zero-max"}},[e._v("zero-max")])],1)],1),e._v(" "),a("md-field",[a("label",{attrs:{for:"offset_x"}},[e._v("Offset(x)")]),e._v(" "),a("md-input",{attrs:{type:"text",name:"offset_x"},model:{value:e.offset_x,callback:function(t){e.offset_x=t},expression:"offset_x"}})],1),e._v(" "),a("md-field",[a("label",{attrs:{for:"offset_y"}},[e._v("Offset(y)")]),e._v(" "),a("md-input",{attrs:{type:"text",name:"offset_y"},model:{value:e.offset_y,callback:function(t){e.offset_y=t},expression:"offset_y"}})],1)],2)],1)])]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.loadFile(),e.showImportDialog=!1}}},[e._v("OK")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showImportDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showInfoDialog},on:{"update:mdActive":function(t){e.showInfoDialog=t}}},[a("md-dialog-content",[a("div",{staticClass:"md-layout-row md-gutter"},[a("div",{staticClass:"md-flex"},[a("label",[e._v("Tags")]),e._v(" "),a("md-chips",{attrs:{"md-limit":20,"md-placeholder":"Type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                    "+e._s(a)+"\n                    ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[a("div",{staticClass:"md-helper-text"},[e._v("Please use tags to describe your sample")])])],1)])]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1}}},[e._v("OK")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showInfoDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showProcessDialog},on:{"update:mdActive":function(t){e.showProcessDialog=t}}},[a("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("div",{staticClass:"md-toolbar-section-start"},[a("h2",[e._v("Processing with A-net")])])])]),e._v(" "),a("md-dialog-content",[a("label",[e._v("Step 1: Select an shareLoc.xyz model:")]),e._v(" "),a("md-field",[a("md-select",{attrs:{name:"worker"},on:{"md-selected":e.workerSelected},model:{value:e.selected_worker_uri,callback:function(t){e.selected_worker_uri=t},expression:"selected_worker_uri"}},e._l(e.worker_list,function(t){return a("md-option",{key:t._id.$oid,attrs:{value:t.uri}},[e._v(e._s(t.uri))])}))],1),e._v(" "),e.selected_worker&&e.selected_worker.tags?a("div",[e.selected_worker.description?a("p",[e._v(e._s(e.selected_worker.description))]):e._e(),e._v(" "),a("label",[e._v("In order to use this model, your sample must contain the following tag(s):")]),e._v(" "),a("div",{staticClass:"md-layout-row md-gutter"},[e._l(e.selected_worker.tags,function(t){return a("md-chip",{key:t,attrs:{disabled:e.anet_running,"md-static":"","md-clickable":""},on:{click:function(a){e.tags.indexOf(t)<0&&e.tags.push(t)}}},[e._v("\n                 "+e._s(t)+"\n               ")])}),e._v(" "),a("div",{staticClass:"md-helper-text"},[e._v("You can click the above tag(s) to tag the sample.")])],2)]):e._e(),e._v(" "),a("br"),e._v(" "),a("div",{staticClass:"md-flex"},[a("label",[e._v("Step 2: tag your sample")]),e._v(" "),a("md-chips",{attrs:{disabled:e.anet_running,"md-limit":20,"md-placeholder":"Type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                    "+e._s(a)+"\n                    ")]}}]),model:{value:e.tags,callback:function(t){e.tags=t},expression:"tags"}},[a("div",{staticClass:"md-helper-text"},[e._v("Please make sure these tags describe your sample accurately.")])])],1),e._v(" "),a("br"),e._v(" "),a("p",[e._v("Warning: If the tags you provided do not match the actual content of your image, ** please do not trust the result **.")]),e._v(" "),this.widefield_available&&this.selected_worker_uri&&-1!==this.selected_worker_uri.indexOf("_wf")?a("md-switch",{attrs:{name:"include_widefield"},model:{value:e.use_widefield,callback:function(t){e.use_widefield=t},expression:"use_widefield"}},[e._v("Include widefield")]):e._e(),e._v(" "),a("br"),e._v(" "),a("p",[e._v('Currently, we only provide limited types of model trained with microtubules and mitochondria. In order to support more, please consider contributing your data through "project one-for-all".')]),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{disabled:e.loading_worker_list||e.anet_running},on:{click:function(t){e.sendForTraining()}}},[a("md-icon",[e._v("send")]),e._v("Send for Training")],1),e._v(" "),a("md-button",{directives:[{name:"show",rawName:"v-show",value:!e.show140,expression:"!show140"}],staticClass:"md-primary",on:{click:function(t){e.show140=!0}}},[e._v("About project one-for-all")]),e._v(" "),a("br"),e._v(" "),e.worker_validation_msg?a("p",[e._v(e._s(e.worker_validation_msg))]):e._e(),e._v(" "),e.anet_running?a("div",{staticClass:"md-layout-row md-gutter"},[a("div",{staticClass:"md-flex"},[a("md-progress-spinner",{attrs:{"md-diameter":100,"md-stroke":10,"md-mode":"indeterminate"}})],1)]):e._e()],1),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary md-raised",attrs:{disabled:e.loading_worker_list||e.anet_running},on:{click:function(t){e.runAnetProcess()}}},[a("md-icon",[e._v("play_arrow")]),e._v("Process")],1),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showProcessDialog=!1}}},[e._v("Cancel")])],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.show140},on:{"update:mdActive":function(t){e.show140=t}}},[a("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("div",{staticClass:"md-toolbar-section-start"},[a("h2",[e._v("Please support project one-for-all -- one model for all")])])])]),e._v(" "),a("md-dialog-content",[a("p",[e._v("As you may know that better results can be achieved if neural networks was trained on data with the same or similar type of data. Typically we need to train a dedicated model for each type of data or structure.")]),e._v(" "),a("p",[e._v("However, this type of model will not scale, because we will end up with a huge collection of pretrained model files, consuming lots of resources and time to train but can not be used except for data looks similar. Plus, it will pose lots of challenges to the infrastructure to store, manage these models.")]),e._v(" "),a("p",[e._v("To address this issue, we are initiating a project aiming for train a single neural network model for all types of biological structure, all types of labeling technique. ")]),e._v(" "),a("p",[e._v("The main idea is to train a single neural network incrementally with more and more data.")]),e._v(" "),a("p",[e._v("It a hard task because when a single network sees different type of data, it will get confused between different types thus compromise the quality.")]),e._v(" "),a("p",[e._v("The switch mechanism shown in our paper provides a way to allow the network to adjust itself to different type of data. While we have shown it works to train a single network for 2~3 types of data, we would like to scale the experiment to tens or even hundreds types.")]),e._v(" "),a("p",[e._v("We will train the network 24x7, and it will be continuously improved as the amount of data grows. Snapshots of the trained model will be freely available for everyone.")]),e._v(" "),a("p",[e._v('We name it "project one-for-all" or "project 140".')]),e._v(" "),a("p",[e._v("The following components will be available for everyone as the project goes:")]),e._v(" "),a("p",[e._v("- an open database for hosting localization microscopy data, accessible through "),a("a",{attrs:{href:"#/repository",target:"_blank"}},[e._v("the repository")]),e._v(".")]),e._v(" "),a("p",[e._v("- a portable smlm file format for saving large localization data, multi-channel, multi-FOV scanning, or even raw images.")]),e._v(" "),a("p",[e._v("- pre-trained models for all types of structure, microscopy etc. ")]),e._v(" "),a("br"),e._v(" "),a("p",[e._v('To support our mission, please donate your data to the project by clicking "Send for Training".')])]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary md-raised",on:{click:function(t){e.show140=!1}}},[e._v("OK")])],1)],1),e._v(" "),e.smlm?a("md-dialog",{attrs:{"md-active":e.showShareDialog},on:{"update:mdActive":function(t){e.showShareDialog=t}}},[a("md-dialog-content",[a("div",{staticClass:"md-layout-row md-gutter"},[a("div",{staticClass:"md-flex"},[a("md-toolbar",{staticClass:"md-transparent md-dense",attrs:{"md-elevation":"0"}},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("div",{staticClass:"md-toolbar-section-start"},[a("h2",[e._v("Share your sample")])])])]),e._v(" "),e.smlm?a("form",[a("md-field",[a("label",[e._v("Name")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.smlm.manifest.name,callback:function(t){e.$set(e.smlm.manifest,"name",t)},expression:"smlm.manifest.name"}})],1),e._v(" "),a("md-field",[a("label",[e._v("Description")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.smlm.manifest.description,callback:function(t){e.$set(e.smlm.manifest,"description",t)},expression:"smlm.manifest.description"}})],1),e._v(" "),a("label",[e._v("Tags")]),e._v(" "),a("md-chips",{attrs:{"md-limit":20,"md-placeholder":"type a tag and press enter..."},scopedSlots:e._u([{key:"md-chip",fn:function(t){var a=t.chip;return[e._v("\n                    "+e._s(a)+"\n                    ")]}}]),model:{value:e.smlm.manifest.tags,callback:function(t){e.$set(e.smlm.manifest,"tags",t)},expression:"smlm.manifest.tags"}},[a("div",{staticClass:"md-helper-text"},[e._v("Please use tags to describe the structure, labeled protein, the dye etc.")])]),e._v(" "),a("md-switch",{attrs:{name:"get_shared_link"},model:{value:e.get_shared_link,callback:function(t){e.get_shared_link=t},expression:"get_shared_link"}},[e._v("Get a private shared link")]),e._v(" "),a("md-switch",{attrs:{name:"make_public"},model:{value:e.make_public,callback:function(t){e.make_public=t},expression:"make_public"}},[e._v("Publish to the Repository")]),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.make_public,expression:"make_public"}]},[e._v("A permanent public url will be generated for your data, and posted on the website. You won't be able to remove the url or the data, but you can tag it as 'deprecated'.")]),e._v(" "),e.make_public?a("md-autocomplete",{attrs:{"md-options":e.licenses,"md-dense":""},model:{value:e.smlm.manifest.license,callback:function(t){e.$set(e.smlm.manifest,"license",t)},expression:"smlm.manifest.license"}},[a("label",[e._v("License")])]):e._e(),e._v(" "),e.make_public?a("p",[e._v("To promote an open community, if no license specified, you data will be automatically licensed under a "),a("a",{attrs:{href:"https://creativecommons.org/licenses/by/4.0/",target:"_blank"}},[e._v("Creative Commons Attribution 4.0 International license.")])]):e._e(),e._v(" "),e.make_public?a("md-field",[a("label",[e._v("How to cite?")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.smlm.manifest.citeAs,callback:function(t){e.$set(e.smlm.manifest,"citeAs",t)},expression:"smlm.manifest.citeAs"}})],1):e._e()],1):e._e(),e._v(" "),a("div",{staticClass:"md-layout md-alignment-center-center"},[a("img",{staticClass:"thumbnail-img",attrs:{src:e.smlm.manifest.thumbnail,alt:e.smlm.manifest.name}})])],1)])]),e._v(" "),a("md-dialog-actions",["admin"==e.store.authrole?a("md-button",{staticClass:"md-primary",on:{click:function(t){e.shareSample(!0,!0),e.showShareDialog=!1}}},[e._v("Force Upload")]):e._e(),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.shareSample(!0),e.showShareDialog=!1}}},[e._v("OK")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showShareDialog=!1}}},[e._v("Cancel")])],1)],1):e._e(),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showFilesDialog},on:{"update:mdActive":function(t){e.showFilesDialog=t}}},[a("md-dialog-content",[a("div",{staticClass:"md-layout-row md-gutter"},[a("div",{staticClass:"md-flex"},[a("md-button",{staticClass:"md-primary ",on:{click:function(t){e.showFilesDialog=!1,e.selectFile(!1)}}},[a("md-icon",[e._v("add")]),e._v(" Load a new file\n              "),a("md-tooltip",[e._v("Open a File")])],1),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showFilesDialog=!1,e.selectFile(!0)}}},[a("md-icon",[e._v("add")]),e._v("Append a file\n                "),a("md-tooltip",[e._v("Add an image to the current smlm file")])],1)],1)])]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showFilesDialog=!1}}},[e._v("OK")])],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showSharedLink},on:{"update:mdActive":function(t){e.showSharedLink=t}}},[a("md-dialog-content",[a("div",{staticClass:"md-layout-row md-gutter"},[a("div",{staticClass:"md-flex"},[a("h1",[e._v("Please copy the following URL for sharing")]),e._v(" "),a("a",{attrs:{href:e.shared_link,target:"_blank"}},[e._v(e._s(e.shared_link))])])])]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showSharedLink=!1}}},[e._v("OK")])],1)],1)],1)},staticRenderFns:[]};var st=a("VU/8")(tt,at,!1,function(e){a("fuZV")},"data-v-39e553e4",null).exports,it={name:"password",props:["action"],data:function(){return{mode:"error",processing:!1,email:"",status:null,passwd_repeat:"",passwd:"",uid:"",acceptTOC:!1,title:"Page not found",router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){"forget"==this.$route.params.action||"forget"==this.action?(this.title="Forget Password",this.mode="forget"):"reset"==this.$route.params.action||"reset"==this.action?(this.title="Reset Password",this.mode="reset"):"set"==this.$route.params.action||"set"==this.action?(this.title="Set User ID and Password",this.mode="set"):"validation"==this.$route.params.action||"validation"==this.action?(this.title="Validate Email",this.mode="validation"):(this.title="Page not found",this.mode="error"),this.api.hideLogin()},methods:{validateEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())},forget_password:function(){var e=this;this.validateEmail(this.email)?this.api.connect(["anonymous"]).then(function(t,a){e.processing=!0,e.store.session.call("org.imod.public.forget_password",[{authid:e.email,webapp:"shareloc.xyz"}],{},{disclose_me:!0}).then(function(){e.processing=!1,e.status="We will soon send an email for you to reset your password, please check your email.",e.api.show("Please check your email.")}).catch(function(t){e.processing=!1,"org.imod.already_sent"==t.error?e.status="You should have received an email, if not, please try again in a few minutes.":(e.status="Something went wrong, please contact us to reset your pasword.",e.api.show("Something went wrong, please contact us to reset your pasword.")),console.error(t)})}):this.api.show("Please provide a valid email address.",4e3)},reset_password:function(){var e=this;if(this.passwd.length<6)this.api.show("Please provide a password longer than 6 letters",3e3);else if(this.passwd_repeat==this.passwd){var t=this.$route.query.authid||this.store.authid,a=autobahn.auth_cra.derive_key(this.passwd,"ANNA-PALM"+t,100,16);this.processing=!0;var s={authid:t,token:this.$route.query.token,secret:a};if("set"==this.mode){if(!this.uid||""==this.uid)return this.status="Please provide a valid user id.",this.api.show("Please provide a valid user id."),void(this.processing=!1);s.uid=this.uid}this.store.session.call("org.imod.public.reset_password",[s],{},{disclose_me:!0}).then(function(){e.processing=!1,e.status="Your password has been updated sucessfully, please login with the new password.",e.api.showLogin(),e.api.show("please login with the new password."),e.router.push("/")}).catch(function(t){e.processing=!1,t.error?(e.status="Error: "+t.args[0],e.api.show("Error: "+t.args[0])):(e.status="Something went wrong, please contact us to reset your pasword.",e.api.show("Something went wrong, please contact us to reset your pasword.")),console.error(t)})}else this.api.show("repeated password does not match.",3e3)}}},nt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"password"},[a("md-subheader",[e._v(" "+e._s(e.title))]),e._v(" "),"error"==e.mode?a("md-button",{staticClass:"md-primary",attrs:{to:"/"}},[e._v("Go Back Home")]):e._e(),e._v(" "),"forget"==e.mode?a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("form",{directives:[{name:"show",rawName:"v-show",value:!e.status,expression:"!status"}]},[a("md-field",[a("label",{attrs:{for:"user-id"}},[e._v("Email")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{disabled:e.processing},on:{click:function(t){e.forget_password()}}},[e._v("Send Validation Email")])],1),e._v(" "),a("h2",{directives:[{name:"show",rawName:"v-show",value:e.status,expression:"status"}]},[e._v(e._s(e.status))])])],1):e._e(),e._v(" "),"reset"==e.mode?a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("form",{directives:[{name:"show",rawName:"v-show",value:!e.status,expression:"!status"}]},[a("md-field",[a("label",{attrs:{for:"user-passwd"}},[e._v("New Password")]),e._v(" "),a("md-input",{attrs:{type:"password"},model:{value:e.passwd,callback:function(t){e.passwd=t},expression:"passwd"}})],1),e._v(" "),""!=e.passwd?a("md-field",[a("label",{attrs:{for:"user-passwd-repeat"}},[e._v("Repeat Password")]),e._v(" "),a("md-input",{attrs:{type:"password",disabled:e.processing},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.reset_password()}},model:{value:e.passwd_repeat,callback:function(t){e.passwd_repeat=t},expression:"passwd_repeat"}}),e._v(" "),e.passwd!=e.passwd_repeat?a("span",{staticClass:"md-error"},[e._v("password does not match")]):e._e()],1):e._e(),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{disabled:e.processing},on:{click:function(t){e.reset_password()}}},[e._v("Reset Password")])],1),e._v(" "),a("h2",{directives:[{name:"show",rawName:"v-show",value:e.status,expression:"status"}]},[e._v(e._s(e.status))])])],1):e._e(),e._v(" "),"set"==e.mode?a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",[a("form",{directives:[{name:"show",rawName:"v-show",value:!e.status,expression:"!status"}]},[a("md-checkbox",{model:{value:e.acceptTOC,callback:function(t){e.acceptTOC=t},expression:"acceptTOC"}},[e._v("I accept the "),a("a",[e._v("Terms of Service")])]),a("md-button",{staticClass:"md-primary",attrs:{to:"/tos",target:"_blank"}},[a("md-icon",[e._v("open_in_new")])],1),e._v(" "),a("md-field",[a("label",{attrs:{for:"user-uid"}},[e._v("User ID")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.uid,callback:function(t){e.uid=t},expression:"uid"}}),e._v(" "),a("span",{staticClass:"md-helper-text"},[e._v("please use 3~12 latin characters")])],1),e._v(" "),a("br"),e._v(" "),a("md-field",[a("label",{attrs:{for:"user-passwd"}},[e._v("Password")]),e._v(" "),a("md-input",{attrs:{type:"password"},model:{value:e.passwd,callback:function(t){e.passwd=t},expression:"passwd"}})],1),e._v(" "),""!=e.passwd?a("md-field",[a("label",{attrs:{for:"user-passwd-repeat"}},[e._v("Repeat Password")]),e._v(" "),a("md-input",{attrs:{type:"password",disabled:e.processing},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.reset_password()}},model:{value:e.passwd_repeat,callback:function(t){e.passwd_repeat=t},expression:"passwd_repeat"}}),e._v(" "),e.passwd!=e.passwd_repeat?a("span",{staticClass:"md-error"},[e._v("password does not match")]):e._e()],1):e._e(),e._v(" "),a("md-button",{staticClass:"md-primary",attrs:{disabled:e.processing||!e.acceptTOC},on:{click:function(t){e.reset_password()}}},[e._v("Set Password")])],1),e._v(" "),a("h2",{directives:[{name:"show",rawName:"v-show",value:e.status,expression:"status"}]},[e._v(e._s(e.status))])])],1):e._e()],1)},staticRenderFns:[]};var ot=a("VU/8")(it,nt,!1,function(e){a("A66K")},"data-v-52586c6f",null).exports,rt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"about"},[a("md-subheader",[e._v("About shareLoc.xyz")]),e._v(" "),a("md-card",[a("md-card-header"),e._v(" "),a("md-card-content",{staticClass:"centered-fixed"},[a("md-icon",{staticClass:"md-size-5x md-small-hide",attrs:{"md-src":"static/img/anna-palm-icon-circle.svg"}}),e._v(" "),a("h2",[e._v("Acknowledgements")]),e._v(" "),a("p",[e._v("ShareLoc.xyz project is mainly supported by\n      ")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.pasteur.fr",target:"_blank"}},[a("img",{attrs:{id:"ip-img",src:"static/img/Institut_Pasteur_logo.svg",alt:"Institut Pasteur"}})])]),e._v(" "),a("br"),e._v(" "),a("p",[e._v("About the "),a("a",{attrs:{href:"#/viewer",target:"_blank"}},[e._v("SMLM Viewer")]),e._v(": the 3D rendering part of is built based on "),a("a",{attrs:{href:"https://twitter.com/Flexi23",target:"_blank"}},[e._v("Felix Woitzel")]),e._v("'s "),a("a",{attrs:{href:"https://github.com/Flexi23/pointcloud-loader/",target:"_blank"}},[e._v("pointcloud-loader")]),e._v(", which is licensed under Apache License V2.0. We also thank "),a("a",{attrs:{href:"https://twitter.com/christlet",target:"_blank"}},[e._v("Christophe Leterrier")]),e._v(" who actively promotes the tool.")])],1)],1),e._v(" "),a("br"),e._v(" "),a("br"),e._v(" "),a("md-divider"),e._v(" "),a("main-footer")],1)},staticRenderFns:[]};var lt=a("VU/8")({name:"about",data:function(){return{router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){},methods:{}},rt,!1,function(e){a("GHAV")},"data-v-fd05ee9a",null).exports,dt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tos"},[a("md-subheader",[e._v("Terms of service")]),e._v(" "),a("md-card",[a("md-card-content",[a("p",[e._v("By accessing the website at "),a("a",{attrs:{href:"https://shareloc.xyz"}},[e._v("https://shareloc.xyz")]),e._v(", you agree to be bound by "),a("a",{attrs:{href:"https://www.pasteur.fr/fr/mentions-legales",target:"_blank"}},[e._v(" LEGAL NOTICE ")]),e._v(" and additional terms specified below, all applicable laws and regulations, and agree that you are responsible for compliance with any applicable local laws. If you do not agree with any of these terms, you are prohibited from using or accessing this site.")]),e._v(" "),a("p",[e._v("1. Data uploaded to the website can only be accessed by the user who uploaded the data, except for cases specified below. ")]),e._v(" "),a("p",[e._v("2. By requesting a shared link on the website, the user agrees to give access to anyone holding the shared link. The shared link will not be displayed, shared or spread by the website, but the user is responsible for keeping the url safely and sharing it only as intended.")]),e._v(" "),a("p",[e._v("3. If a user publishes data on the website, a permanent public url will be generated to link with the data. Once generated, the public url can be announced on the website or sent to other users with notifications by the website. The user will not be able to remove the data or the url from the website. However, the user can tag the data as 'deprecated'. We reserve the right to refuse requests to remove published data.")]),e._v(" "),a("p",[e._v("4. Except where otherwise noted, content on this website and data uploaded to the website are licensed under a Creative Commons Attribution 4.0 International license (CC BY 4.0). When sharing or publishing user data, the user can specify a license other than CC BY 4.0. If no license is specified, the CC BY 4.0 license will be automatically applied to the content with a shared link or a public link.")]),e._v(" "),a("p",[e._v("5. Data will be tagged mainly by the user, but tags can also be set automatically by features enabled or triggered by the user. These automatically generated tags will have the same effect as if set by the user manually.")]),e._v(" "),a("p",[e._v("6. Data uploaded to the website should be assigned correct tags. We reserve the right to change incorrect tags or remove data without notice.")]),e._v(" "),a("p",[e._v("7. For the purpose of maintenance and development of the website, the site administrator and developers are allowed to inspect, modify, and remove any data uploaded to the website without notice. ")]),e._v(" "),a("p",[e._v("8. User identity (including e-mail, user id and password) should only be used by the user through the web interface with a web browser, the user is not allowed to use the website service through a software, a script or a robot not provided by the website.")])])],1)],1)},staticRenderFns:[]};var mt=a("VU/8")({name:"tos",data:function(){return{router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){},methods:{}},dt,!1,function(e){a("qx5G")},"data-v-47471628",null).exports;var ct=a("EFqf"),ut=a.n(ct),_t={name:"faq",data:function(){return{source:"\n\nTo be done...\n\n",router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},computed:{compiledMarkdown:function(){return ut()(this.source,{sanitize:!0})}},mounted:function(){},methods:{}},pt={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"faq"},[t("md-subheader",[this._v("FREQUENTLY ASKED QUESTIONS")]),this._v(" "),t("md-card",[t("md-card-header"),this._v(" "),t("md-card-content",[t("div",{domProps:{innerHTML:this._s(this.compiledMarkdown)}})])],1)],1)},staticRenderFns:[]};var ht=a("VU/8")(_t,pt,!1,function(e){a("A+BG")},"data-v-62bff1b8",null).exports;s.default.use(i.a);var ft=new i.a({base:window.location.pathName,routes:[{path:"/",name:"Home",component:d},{path:"/admin",name:"Admin",component:v},{path:"/datasets",name:"Datasets",component:x},{path:"/repository",name:"Repository",component:T},{path:"/repo",redirect:{name:"Repository"}},{path:"/gallery",redirect:{name:"Repository"}},{path:"/options",name:"Options",component:S},{path:"/files",name:"Files",component:F},{path:"/viewer",name:"Viewer",component:st},{path:"/view",name:"Viewe",component:st},{path:"/password/:action",name:"Password",component:ot},{path:"/about",name:"About",component:lt},{path:"/tos",name:"TOS",component:mt},{path:"/faq",name:"FAQ",component:ht}]}),gt=a("Lgyv"),vt=a.n(gt),wt=(a("4+hh"),a("giDI"),{name:"navbar",data:function(){return{snackbar_info:"",snackbar_duration:1e3,showSnackbar:!1,showQuestion:!1,screenWidth:window.innerWidth,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this;this.store.api.show=this.show,this.screenWidth=window.innerWidth;this.store.event_bus.$on("resize",function(t){e.screenWidth=t.width}),this.api.contact=this.contact},methods:{contact:function(){this.showQuestion=!0},show:function(e,t){this.snackbar_info=e,this.snackbar_duration=t||3e3,this.showSnackbar=!0}}}),bt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"md-toolbar-row"},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("md-button",{attrs:{to:"/"}},[a("div",{staticClass:"site-title"},[e._v("shareLoc.xyz"),a("span",{staticClass:"superscript"},[e._v("alpha")])])]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:"/"!=e.$route.path,expression:"$route.path!='/'"}],staticClass:"md-layout-item md-medium-hide subheader-title"},[e._v("Localization Data Sharing Made Easy")]),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[e.screenWidth<600?a("md-menu",{attrs:{"md-size":"medium"}},[a("md-button",{staticClass:"md-primary md-icon-button",attrs:{"md-menu-trigger":""}},[a("md-icon",[e._v("menu")])],1),e._v(" "),a("md-menu-content",[a("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:!e.store.signed_in,expression:"!store.signed_in"}],staticClass:"md-primary md-button menu-button",on:{click:function(t){e.api.showLogin()}}},[e._v(" Login/Signup ")]),e._v(" "),a("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/"!=e.$route.path,expression:"$route.path != '/'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/"}},[e._v("Home")]),e._v(" "),a("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/viewer"!=e.$route.path&&"/view"!=e.$route.path,expression:"$route.path != '/viewer' && $route.path != '/view'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/viewer"}},[e._v("Viewer")]),e._v(" "),a("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/repository"!=e.$route.path,expression:"$route.path != '/repository'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/repository"}},[e._v("Repository")]),e._v(" "),a("md-menu-item",{directives:[{name:"show",rawName:"v-show",value:"/about"!=e.$route.path,expression:"$route.path != '/about'"}],staticClass:"md-primary md-button menu-button",attrs:{to:"/about"}},[e._v("About")])],1)],1):e._e(),e._v(" "),e.screenWidth>=600?a("md-button",{directives:[{name:"show",rawName:"v-show",value:"/"!=e.$route.path,expression:"$route.path != '/'"}],staticClass:"md-accent",attrs:{to:"/"}},[a("md-icon",[e._v("home")]),e._v(" Home\n            "),a("md-tooltip",[e._v("Home Page")])],1):e._e(),e._v("\n          Â \n          "),e.screenWidth>=600?a("md-button",{directives:[{name:"show",rawName:"v-show",value:"/viewer"!=e.$route.path&&"/view"!=e.$route.path,expression:"$route.path != '/viewer' && $route.path != '/view'"}],staticClass:"md-accent",attrs:{to:"/viewer"}},[a("md-icon",[e._v("pageview")]),e._v(" Viewer\n            "),a("md-tooltip",[e._v("SMLM data viewer")])],1):e._e(),e._v(" "),e._v("\n          Â \n          "),e.screenWidth>=600?a("md-button",{directives:[{name:"show",rawName:"v-show",value:"/repository"!=e.$route.path,expression:"$route.path != '/repository'"}],staticClass:"md-accent",attrs:{to:"/repository"}},[a("md-icon",[e._v("insert_photo")]),e._v(" Repository\n            "),a("md-tooltip",[e._v("datasets")])],1):e._e(),e._v("\n          Â \n          "),e.screenWidth>=600?a("md-button",{directives:[{name:"show",rawName:"v-show",value:"/about"!=e.$route.path,expression:"$route.path != '/about'"}],staticClass:"md-accent",attrs:{to:"/about"}},[a("md-icon",[e._v("info")]),e._v(" About\n            "),a("md-tooltip",[e._v("About shareLoc.xyz")])],1):e._e(),e._v("\n          Â \n          Â \n          "),e.screenWidth>=600&&!e.store.signed_in?a("md-button",{staticClass:"md-accent",attrs:{id:"login-btn"},on:{click:function(t){e.api.showLogin()}}},[e._v("\n              Login/Sign Up")]):e._e(),e._v(" "),a("md-menu",{directives:[{name:"show",rawName:"v-show",value:e.store.signed_in,expression:"store.signed_in"}],attrs:{"md-size":"medium"}},[a("md-button",{staticClass:"md-raised md-accent md-icon-button",attrs:{"md-menu-trigger":""}},[a("md-icon",[e._v("person")]),e._v(" "),a("md-tooltip",[e._v(" "+e._s(e.store.uid||e.store.authid))])],1),e._v(" "),a("md-menu-content",["admin"==e.store.authrole?a("md-menu-item",{staticClass:"md-primary md-button menu-button",attrs:{to:"/admin"}},[a("div",[e._v("admin")])]):e._e(),e._v(" "),"admin"==e.store.authrole?a("md-menu-item",{staticClass:"md-primary md-button menu-button",attrs:{to:"/datasets"}},[a("div",[e._v("datasets")])]):e._e(),e._v(" "),a("md-menu-item",{staticClass:"md-primary md-button menu-button",attrs:{to:"/options"}},[a("div",[e._v("options")])]),e._v(" "),a("md-menu-item",{staticClass:"md-warn md-button menu-button",on:{click:e.api.logout}},[a("div",[e._v("sign out")])])],1)],1)],1)],1),e._v(" "),a("md-snackbar",{staticClass:"md-accent",attrs:{"md-position":"center","md-active":e.showSnackbar,"md-duration":e.snackbar_duration},on:{"update:mdActive":function(t){e.showSnackbar=t}}},[a("span",[e._v(e._s(e.snackbar_info))]),e._v(" "),a("md-button",{staticClass:"md-accent",on:{click:function(t){e.showSnackbar=!1}}},[e._v("close")])],1),e._v(" "),a("login-dialog",{attrs:{label:"login/signup"}}),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showQuestion,id:"question-dialog"},on:{"update:mdActive":function(t){e.showQuestion=t}}},[a("md-toolbar",{staticClass:"md-primary"},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("md-subheader",[e._v("\n             Contact us\n           ")]),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-icon-button",on:{click:function(t){e.showQuestion=!1}}},[a("md-icon",[e._v("close")])],1)],1)],1)]),e._v(" "),a("md-dialog-content",[a("div",{staticClass:"holds-the-iframe"},[a("iframe",{attrs:{id:"typeform-full",width:"100%",height:"100%",frameborder:"0",src:"https://oeway.typeform.com/to/rdkPmd"}})])]),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showQuestion=!1}}},[e._v("Close")])],1)],1)],1)},staticRenderFns:[]};var yt=a("VU/8")(wt,bt,!1,function(e){a("MvkS")},"data-v-4f3756fe",null).exports,kt={name:"login-dialog",props:["label"],data:function(){return{processing:!1,mode:"login",authid:"",signed_up:!1,passwd:"",passwd_repeat:"",status:null,showDialog:!1,showForgetDialog:!1,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){this.api.connect=this.connect,this.api.login=this.login,this.api.logout=this.logout,this.api.showLogin=this.showLogin,this.api.hideLogin=this.hideLogin,this.api.handle_notification=this.handle_notification},methods:{login_signup:function(){this.status=null,console.log(),"login-tab"==this.$refs.tabs.activeTab?this.login("wampcra"):"signup-tab"==this.$refs.tabs.activeTab?this.signup():console.error("error mode.")},validateEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e.toLowerCase())},signup:function(){var e=this;console.log("signup"),this.connect(["anonymous"]).then(function(t,a){if(e.validateEmail(e.authid)){e.processing=!0;var s=setTimeout(function(){e.processing=!1,e.status="Something went wrong, please try agian.",e.api.show("Connection timeout, please try again."),console.error("Connection timeout, please try again.")},5e3);t.call("org.imod.public.signup",[{authid:e.authid,secret:null,webapp:"shareloc.xyz"}],{},{disclose_me:!0}).then(function(){clearTimeout(s),e.processing=!1,e.api.show("Please check your email:'"+e.authid+"'.",5e3),e.status="You will soon receive an email with a link to set your password. If you do not receive the email, please check your spam or bulk email folder.",e.signed_up=!0}).catch(function(t){e.processing=!1,clearTimeout(s),e.status="Error: "+t.args[0],t.args?e.api.show(t.args[0],5e3):e.api.show(t)}),t.subscribe("org.imod.public.message",e.handle_notification)}else e.api.show("Please provide a valid email address.",4e3)})},handle_notification:function(e,t,a){console.log(a)},login:function(e){var t=this;return new M.a(function(a,s){console.log("try to login with ",e),t.processing=!0;var i=setTimeout(function(){t.processing=!1,"wampcra"==e&&(t.status="Something went wrong, please check your email and password.",t.api.show("Connection timeout, please try again."),console.error("Connection timeout, please try again."),s())},5e3);t.connect([e],t.authid,t.passwd).then(function(e){clearTimeout(i),t.processing=!1,console.log("connected with",t.store.authrole),"anonymous"!=t.store.authrole&&t.store.session.call("org.imod.user.get_user_data",[null],{},{disclose_me:!0}).then(function(s){t.processing=!1,s&&(t.store.user_data=s,t.store.uid=s.uid),t.closeDialog("login_dialog"),t.api.show("You are now logged in as "+t.store.authid),t.store.signed_in=!0,e.subscribe("org.imod.user."+t.store.authid,t.handle_notification).catch(function(e){console.error(e)}),t.store.event_bus.$emit("signed_in",t.store.authid),a()}).catch(function(e){t.processing=!1,e.error?(t.status="Error: "+e.args[0],t.api.show("Error: "+e.args[0])):(t.status="Something went wrong, please contact us to reset your pasword.",t.api.show("Something went wrong, please contact us to reset your pasword.")),console.error(e),s()}),e.subscribe("org.imod.public.message",t.handle_notification).catch(function(e){console.error(e)})}).catch(function(){t.processing=!1,console.log("connection failed with ",e),s()})})},showLogin:function(){this.passwd="",this.status=null,this.showDialog=!0},hideLogin:function(){this.showDialog=!1},closeDialog:function(){this.status=null,this.showDialog=!1},logout:function(){this.store.connection.close("wamp.close.logout")},connect:function(e,t,a){var s=this;return e=e||["anonymous"],new M.a(function(i,n){var o="",r=new autobahn.Connection({url:"wss://dai.pasteur.fr/ws",realm:"realm1",authmethods:e,authid:t,onchallenge:function(e,t,a){if(console.log(t),"wampcra"===t)return console.log("onchallenge: authenticating via '"+t+"' and challenge '"+a.challenge+"'"),autobahn.auth_cra.sign(o,a.challenge)},on_user_error:function(e,t){n(),this.api.show(t),console.error(e)}});t&&a&&(o=autobahn.auth_cra.derive_key(a,"ANNA-PALM"+t,100,16)),r.onopen=function(e,t){s.store.session=e,s.store.connection=r,s.store.authid=t.authid,s.store.authrole=t.authrole,s.store.connected=!0,console.log("connected: ",t.authid,t.authrole),i(e,r),s.store.event_bus.$emit("connected",s.store.authid)},r.onclose=function(e){s.store.session=null,s.store.connection=null,s.store.authid=null,s.store.uid=null,s.store.authrole=null,s.store.signed_in=!1,s.store.connected=!1,s.store.signed_in&&s.api.show("logged out"),s.processing=!1,n()},r.open()})},disconnect:function(){}}},xt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("md-dialog",{attrs:{"md-active":e.showDialog},on:{"update:mdActive":function(t){e.showDialog=t}}},[a("md-dialog-content",[a("md-tabs",{ref:"tabs",staticClass:"md-transparent",attrs:{"md-sync-route":""}},[a("md-tab",{attrs:{id:"login-tab","md-label":"Login"}},[a("form",[a("md-field",[a("label",{attrs:{for:"user-id"}},[e._v("Email")]),e._v(" "),a("md-input",{attrs:{type:"text"},model:{value:e.authid,callback:function(t){e.authid=t},expression:"authid"}})],1),e._v(" "),a("md-field",[a("label",{attrs:{for:"user-passwd"}},[e._v("Password")]),e._v(" "),a("md-input",{attrs:{type:"password"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.login_signup()}},model:{value:e.passwd,callback:function(t){e.passwd=t},expression:"passwd"}}),e._v(" "),a("span",{staticClass:"md-helper-text clickable-helper",on:{click:function(t){e.showDialog=!1,e.showForgetDialog=!0}}},[e._v("forget password")])],1)],1)]),e._v(" "),a("md-tab",{attrs:{id:"signup-tab","md-label":"Signup"}},[a("form",[a("md-field",[a("label",{attrs:{for:"user-id"}},[e._v("Email")]),e._v(" "),a("md-input",{attrs:{disabled:e.signed_up,type:"text"},nativeOn:{keyup:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;e.login_signup()}},model:{value:e.authid,callback:function(t){e.authid=t},expression:"authid"}})],1)],1)])],1),e._v(" "),a("p",{directives:[{name:"show",rawName:"v-show",value:e.status,expression:"status"}]},[e._v(e._s(e.status))]),e._v(" "),a("p",[a("md-button",{attrs:{id:"help-button"},on:{click:function(t){e.api&&e.api.contact&&e.api.contact()}}},[e._v(" Can't sign up/login?")])],1)],1),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",attrs:{disabled:e.processing},on:{click:function(t){e.login_signup()}}},[e._v("OK")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.closeDialog()}}},[e._v("Cancel")])],1)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showForgetDialog},on:{"update:mdActive":function(t){e.showForgetDialog=t}}},[a("md-dialog-content",[a("password",{attrs:{action:"forget"}})],1),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showForgetDialog=!1}}},[e._v("Exit")])],1)],1)],1)},staticRenderFns:[]};var Ct=a("VU/8")(kt,xt,!1,function(e){a("mz3i")},"data-v-5035de9c",null).exports,St={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("md-dialog",{attrs:{"md-active":e.showDialog},on:{"update:mdActive":function(t){e.showDialog=t}}},[a("md-toolbar",{staticClass:"md-primary md-dense",attrs:{"md-elevation":"0"}},[a("div",{staticClass:"md-toolbar-row",attrs:{flex:""}},[a("div",{staticClass:"md-toolbar-section-start"},[a("h2",[e._v("Upload a localization table")])]),e._v(" "),a("div",{staticClass:"md-toolbar-section-end"},[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showDialog=!1,e.submit_sample(e.sample)}}},[e._v("OK")]),e._v(" "),a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showDialog=!1,e.submit_sample()}}},[e._v("Cancel")])],1)])]),e._v(" "),a("br"),e._v(" "),a("md-dialog-content",[a("viewer",{scopedSlots:e._u([{key:"actions",fn:function(t){return a("md-button",{staticClass:"md-primary",on:{click:function(e){t.$emit("share")}}},[e._v("Upload")])}}])})],1)],1)},staticRenderFns:[]};var At=a("VU/8")({name:"sample-dialog",props:["title"],data:function(){return{hist_table:[],hist_options:{},loading_status:"",loading:!1,loading_progress:0,zipping:!1,zipping_progress:0,zipping_status:"",upload_enabled:!1,uploading:!1,upload_prgress:0,tableUint8Arrays:null,tableArrays:null,metadata:{},sample:{},showDialog:!1,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){this.api.showSampleDialog=this.showSampleDialog},methods:{showSampleDialog:function(e){this.sample=e||{name:"",type:"default"},this.showDialog=!0},closeDialog:function(){this.showDialog=!1},submit_sample:function(e){this.$emit("input",e),this.$emit("close",e)}}},St,!1,function(e){a("KdU5")},"data-v-98128896",null).exports,Dt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return"/viewer"!=e.$route.path&&"/view"!=e.$route.path?a("div",{staticClass:"footer"},[a("div",{staticClass:"md-layout md-alignment-center-center"},[a("md-button",{staticClass:"md-accent footer-button",attrs:{target:"_blank"},on:{click:function(t){e.api&&e.api.contact&&e.api.contact()}}},[e._v("Ask a question")]),e._v(" "),a("md-button",{staticClass:"md-accent footer-button",attrs:{target:"_blank",href:"https://github.com/imodpasteur/shareLoc.xyz/issues"}},[e._v("Create an issue on Github")])],1),e._v(" "),a("div",{staticClass:"md-layout md-alignment-center-center"},[a("md-button",{staticClass:"footer-button",attrs:{href:"https://creativecommons.org/licenses/by/4.0/",target:"_blank"}},[a("md-tooltip",[e._v("Except where otherwise noted, content on this site is licensed under a Creative Commons Attribution 4.0 International license.")]),e._v(" "),a("img",{attrs:{id:"cc-by-img",src:"static/img/by.svg",alt:"CC BY 4.0"}}),e._v(" Site content licensed under CC BY 4.0\n    ")],1),e._v(" "),a("md-button",{staticClass:"footer-button",on:{click:function(t){e.mode="tos",e.showDialog=!0}}},[a("md-tooltip",[e._v("By accessing the website, you are agreeing to be bound by the Terms of Service.")]),e._v("\n      Terms of Service")],1),e._v(" "),a("md-button",{staticClass:"footer-button",on:{click:function(t){e.mode="about",e.showDialog=!0}}},[e._v("About shareLoc.xyz")])],1),e._v(" "),a("div",{staticClass:"md-layout md-alignment-center-center"},[a("md-button",{staticClass:"footer-button",attrs:{href:"https://github.com/oeway",target:"_blank"}},[e._v("Made by Wei OUYANG with "),a("span",{staticClass:"red"},[e._v("â¤")])]),e._v(" "),a("md-button",{staticClass:"footer-button",attrs:{target:"_blank",href:"https://sites.google.com/site/imagingandmodeling/"}},[e._v("Powered by Imaging and Modeling Unit")]),e._v(" "),e._m(0)],1),e._v(" "),a("md-dialog",{attrs:{"md-active":e.showDialog},on:{"update:mdActive":function(t){e.showDialog=t}}},[a("md-dialog-content",["about"==e.mode?a("about"):e._e(),e._v(" "),"tos"==e.mode?a("tos"):e._e()],1),e._v(" "),a("md-dialog-actions",[a("md-button",{staticClass:"md-primary",on:{click:function(t){e.showDialog=!1}}},[e._v("OK")])],1)],1)],1):e._e()},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("a",{attrs:{href:"https://www.pasteur.fr",target:"_blank"}},[t("img",{attrs:{id:"ip-img",src:"static/img/Institut_Pasteur_logo.svg",alt:"Institut Pasteur"}})])}]};var Ft=a("VU/8")({name:"main-footer",data:function(){return{mode:"about",showDialog:!1,router:this.$root.$data.router,store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){},methods:{}},Dt,!1,function(e){a("kUtg")},"data-v-4250500e",null).exports,zt={debug:!0,wsuri:"wss://dai.pasteur.fr/ws",signed_in:!1,event_bus:new s.default,authid:"",authrole:"",uid:"",api:{},session:null,connection:null},$t={name:"app",data:function(){return{store:this.$root.$data.store,api:this.$root.$data.store.api}},mounted:function(){var e=this;this.api.login("cookie").catch(function(){e.api.login("anonymous")}),this.$nextTick(function(){var t=function(t){e.store.windowHeight=window.innerHeight,e.store.windowWidth=window.innerWidth,e.store.event_bus.$emit("resize",{height:e.store.windowHeight,width:e.store.windowWidth})};t(),document.addEventListener("orientationchange",window.onresize=t),e.store.event_bus.$on("connected",function(e){try{ga("set","userId",e)}catch(e){console.error("google analytics error:",e)}}),e.api.ga_send=function(e){try{ga("send","pageview",e),console.log("ga_send:",e)}catch(e){console.error("google analytics error:",e)}}})},methods:{},watch:{$route:function(e){try{ga("send","pageview",e.path),console.log("pageview:",e.path)}catch(e){console.error("google analytics error:",e)}}}},Et={render:function(){var e=this.$createElement,t=this._self._c||e;return t("md-app",{attrs:{id:"app","md-waterfall":"","md-mode":"fixed"}},[t("md-app-toolbar",{staticClass:"md-primary"},[t("navbar")],1),this._v(" "),t("md-app-content",[t("router-view")],1)],1)},staticRenderFns:[]};var Tt=a("VU/8")($t,Et,!1,function(e){a("Xksg")},null,null).exports,Rt=a("GDE4"),Mt=a.n(Rt);s.default.config.productionTip=!1,s.default.use(vt.a),s.default.component("vue-slider",Mt.a),s.default.component("navbar",yt),s.default.component("files",F),s.default.component("login-dialog",Ct),s.default.component("sample-dialog",At),s.default.component("viewer",st),s.default.component("password",ot),s.default.component("main-footer",Ft),s.default.component("about",lt),s.default.component("tos",mt),s.default.component("faq",ht),s.default.component("repository",T);s.default.filter("truncate",function(e,t,a){a=a||"...";var s=document.createElement("div");s.innerHTML=e;var i=s.textContent;return i.length>t?i.slice(0,t)+a:i}),new s.default({el:"#app",router:ft,data:{store:zt,router:ft},template:"<App/>",components:{App:Tt}})},OA9G:function(e,t){},Xksg:function(e,t){},YZJ3:function(e,t){},fuZV:function(e,t){},giDI:function(e,t){},kUtg:function(e,t){},mz3i:function(e,t){},qx5G:function(e,t){},xzB3:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.0dcb487817529398b980.js.map